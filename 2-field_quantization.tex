\chapter{Electromagnetic Field Quantization and Electromagnetic Worldline Path Integrals}

\label{ch:EM_quantization}

This chapter develops the worldline path integrals for electromagnetism with a spatially dependent
dielectric function.
Following the trail set by the Dirichlet scalar worldlines, we will 
develop the path integral quantization of the EM field.
This is a non-trivial exercise since electromagnetism is a gauge theory,
 and the gauge degree of freedom must be correctly handled.
The worldline path integrals developed based on the full gauge theory
path integral have a number of distasteful features.
That prompts searching for a simpler theory in terms of the physical degrees of freedom 
in a simple geometry.  

We start by discussing other work on quantization of the electromagnetic field
in media.  Then we introduce the classical field theory for the EM field in both Lagrangian and 
Hamiltonian forms.  We quantize the theory, and then develop the partition function.
The partition function can be converted to a Euclidean path integral, which still has a residual gauge-freedom.
The gauge freedom is removed via Faddeev-Popov gauge fixing, with a spatially dependent gauge. 
We then develop the worldline path integral for the full gauge theory, and comment on the resulting
structure.
In the search for a more tractable model system, we will show that in planar geometries the 
electromagnetic field can be split into two non-interacting scalar fields.
We will then develop the worldline path integrals for those scalar fields, which will form
the basis for our later work.  

(As a matter of convention we will distinguish between $\vect{r}$ as a position label or parameter
 and $\vect{x}$, the coordinate of a path integral)

\section{Approaches to Quantizing Electromagnetism in Media}

Quantization of the electromagnetic field inside dielectric media provides a number of challenges 
beyond quantization in vacuum~\cite{Huttner1992,Dung1998,Bechler1999,Bordag1998,Rahi2009,Reid2013}.  
 First, a dielectric is spatially varying, which makes it much harder to develop the requisite mode 
 functions.  It is possible to write down the equations the modes must obey, and quantize the amplitudes
 in analogy with free space~\cite{Glauber1991}.
 Ideally, our procedure will not make any reference to a specific geometry or spatial dependence of the dielectric,
 nor require that we solve the mode functions.   

Second, the dielectric complicates the choice of gauge-fixing.  (We will discuss this at length in Sec.~\ref{sec:gauge_fixing}.)
In brief, electromagnetism has a gauge symmetry, or has redundant degrees of freedom, which must be 
removed in the quantization procedure.  One must fix the gauge by imposing a subsidiary or gauge condition
on the fields.  In free space this is typically done by fixing Coulomb or Lorenz gauge, which have the 
decouple the radiative and static charge problems, or maintaining relativistic invariance.
However inside a dielectric (starting at the level of macroscopic fields) the usual gauge-fixings lose these nice
features, and must be replaced by a dielectric dependent condition.  

Third, since the dielectric has some frequency response or dispersion, the Kramers-Kr\"onig relations 
require that there is also loss or dissipation.
In a quantum theory, dissipation is usually handled by coupling the system to a bath, and then
integrating out the bath degrees of freedom~\cite{Huttner1992,Dung1998,Bechler1999}. 
The light field is linearly coupled to the dielectric medium which is treated
as a bath of harmonic oscillators.
The dielectric medium is in turn coupled to a bath of harmonic oscillators, which provide the damping.
Integrating out the bath yields the required dispersion and dissipation for the medium, 
while integrating out the medium's harmonic oscillators yields a frequency dependent dielectric constant.
The damping also implies dissipation via the fluctuation-dissipation theorem.  
Some quantization procedure's lead to fluctuating noise currents which provide the dissipation~\cite{Dung1998}.

% Some care is required to handle dispersion, since the Kramers-Kr\"onig relations
%  imply this also requires dissipation.  
% This is typically handled by coupling the electromagnetic field to an idealized
%  medium, which is in turn coupled to a bath of oscillators that models
%  dissipation~\cite{Huttner1992,Dung1998}.

It is not strictly necessary to assume linear coupling of the fields to harmonic oscillators. 
The dielectric function can be understood in terms of the linear-response of the underlying 
medium to the electromagnetic field~(\cite{Altland2011}).
Instead of restricting the model to explicitly linear harmonic media, the connection to linear response
theory allows one to find the effective linear model for whatever material is under consideration.
Similar reasoning has been used for the Casimir effect between graphene sheets~\cite{Bordag2009a,Fialkovsky2011}.
This approach is more general, since it yields the effective linear response, 
without being restricted to assuming a linear model from the outset.  This was used to 
motivate the effective Lagrangian description in terms of macroscopic fields by Rahi\etal in their 
work on the scattering method~\cite{Rahi2009}.    From this starting point Reid\etal was able to 
quantize the EM field, under the assumption of piecewise constant dielectric media, where the EM
boundary conditions are explicitly enforced at the interfaces.
\comment{Expanding on Bordag's 2007 effort to fix boundary conditions at surfaces for scalar problems.)}
Enforcing those boundary conditions allows the remaining computations to proceed
 as if the media were homogenous and filled all of space, based on a version of Green's theorem~\cite{Emig2004}.

Fewer authors have considered path integral quantization of the EM field inside a dielectric.
Bechler has carried out path integral quantization for a harmonic medium 
including dispersion, and shown agreement with previous results in terms 
of noise operators~(\cite{Bechler1999,Bechler2006}).  
The field action is quadratic in the fields, and there are only linear couplings between other
harmonic fields, the resulting path integrals are also Gaussians.  Such Gaussian path integrals 
are straightforward to evaluate (certainly in comparison with the nonlinear field theories condensed
in condensed matter and high energy physics where perturbation theory is the only recourse.)
The primary results in Bechler's work were finding the form of the field propagator, and showing consistency with the 
other approaches by Huttner and Barnett~\cite{Huttner1992} and Langevin equations by Dung\etal\cite{Dung1998},
 rather than new computations exploiting the propagator.    The results were all framed in terms of the 
Fourier decompositions of the fields in terms of wavenumber, which is unsuitable for a worldline procedure.

\begin{itemize}
  \item Dalton Multipolar quantization. \cite{Dalton1996}.  Mostly concerned with light interacting with 
    atoms in media.
  \item Knoell, Vogel and Gunnar-Wesch~\cite{Knoell1987}.  Frequency independent dielectric quantization.
    Field operators etc, canonical quantization.  
  \item Philbin canonical quantization for operators in spatially dependent dielectric at macroscopic level.
    \cite{Philbin2010}.   Results used in Casimir work~\cite{Philbin2011}.
  \item Raabe~\cite{Raabe2006}.  Continuation of langevin noise source approach to quantization.  
\end{itemize}

 Bordag and others also carried out path integral quantization of
 the EM field inside a spatially varying dielectric neglecting dispersion, starting from the 
effective Lagrangian description for the macroscopic fields~\cite{Bordag1998}.
They fix a generalized Lorenz gauge, and set about deriving the Heat Kernel.
  The primary focus here was to explore the divergence structure of the theory (i.e. how does QED in media
behave at high frequencies and small wavelengths).
The Heat Kernel expansion, corresponds to the small time expansion of a worldline path integral.
(In most work on worldline path integrals these high energy efects (corresponding to short path times)
 are renormalized away by subtracting off the vacuum path integral.)
  Unfortunately, these results are hard to interpret given that the non-physical
 degrees of freedom for the field do not cleanly decouple, as opposed to the 
usual situation in free space QED.
A later paper considering the quantization for EM in a spherical dielectric ball found better 
results by exploiting the dual potentials~\cite{Bordag1999}.  Even so, the majority of the work considered high energy
limits, and formal matters such as the divergences of the theory.  

(We will briefly note methods based on computing van der Waals energies in the static field limit,
by evaluating functional determinants for discrete spatial grids~\cite{Maggs2006,Pasquali2008}. This approach 
omits any time evolution of the fields, but it does offer a direct method of trying to evaluate the field path integral.
That work relied on direct spatial discretization to evaluate the functional determinants, which limits
the size of medium that can be considered.)

%copied from Intro.  
We are interested in small energies relative to the binding energies of the dielectrics, and very weak
fields.
In this limit, the effect of the electromagnetic field on the matter can be described 
by the linear susceptibility $\chi$.
The susceptibility $\chi$ is found from the microscopic theory via linear-response such as the Kubo formula~\cite{Rahi2009,Altland2011}.
The linear response tensor is also directly related to the polarization tensor for the field~\cite{Bordag2009, Abrisokov}
In a sense these difficulties could be circumvented.  We are merely considering QED in a linear approximation
in the interaction between matter and the EM field (while $\epsr$ is some unspecified function of space),
and in a long wavelength approximation to the matter.  
Gauge fixing is no problem at all for electrons and photons in this limit.  
Perhaps a better procedure is 
Considering the difficulties with carrying out this path integral quantization with the macroscopic fields,

There is another approach to classical electromagnetic scattering, which explicitly focuses on 
the two physical degrees of freedom.
The Hertz potentials express the electromagnetic radiation field in terms of two scalar fields, where 
there is one special direction. \comment{Cite Hertz} The Hertz potentials were first introduced to discuss EM scattering 
in spherical geometries~\cite{Nisbet1955,Nisbet1957}. 
They have also been used in the Casimir context for a cylindrical geometry~\cite{Crocce2005}.
Unfortunately, the wave equations for the Hertz potentials when used in the EM lagrangian 
lead to fourth order differential operators.  This is unsuitable for a worldline method 
where we expect second order differential operators to find Gaussian paths.

Another potentially fruitful analogy exists between the curved space of general relativity, 
and the fact that light bends in spatially varying dielectrics~\cite{Leonhardt2000}. 
 Electromagnetism can be quantized on a curved background without much difficulty.
One merely replaces all derivatives by their covariant counterparts, which include correction terms
based on the metric~\cite{Carroll2004}.
The analogy between gravity and dielectrics has been exploited by Leonhardt in particular to propose technology such as optical 
black holes, cloaking fields, perfect lenses, and more~\cite{Leonhardt2006}.  
Unfortunately, this analogy is only exact when $\epsilon=\mu$~\cite{Leonhardt2000}, 
which most materials do not satisfy.
It is possible to mock the $\epsilon=\mu$ condition over a narrow frequency range using metamaterials, 
as some experiments have demonstrated~\cite{Leonhardt2006}.  
So while there are a number of similarities between a dielectric medium and a metric,
those similarities do not extend to an immediate shortcut past all of these issues.

We choose to avoid this issue by focusing on improved scalar models, 
that also correspond to the physical degrees of freedom for the field in certain geometries.  
The scalars we develop correspond with the Hertz potentials for the plane, and in fact the TE/TM decomposition 
is commonly exploited in planar geometries \comment{Cite Bordag for planar paper and projection}

We have some proposals for general methods, but I have not seen how to convert between
basis so as to stitch together a global atlas from local polarization charts.  (The comparison with 
the language of differential geometry is deliberate.  In differential geometry a manifold can be covered with 
coordinates by the union of coordinate charts, which are local maps of the manifold to $\mathbb{R}^n$.  
Where the charts overlap, the coordinate maps must be consistently mapped into one another.)
While it might not be possible to cover the whole space globally with a single set of polarizations, 
it may be possible to do so locally.  For example, one could use the nearest surface 
normal to define a plane to define the TE/TM polarizations.  As the path propagates, it would be 
necessary to update the polarizations, and convert the amplitudes into the new coordinates.

\section{Classical Field Theory}

Maxwell's equations in a dielectric, non magnetic medium, without sources  are
\begin{align}
\nabla \cdot \vect{D} = 0  \qquad 
&\nabla \times \vect{E} = -\partial_t\vect{B}\\
\nabla \cdot \vect{B} = 0\qquad
&\nabla\times\vect{H} = \partial_t\vect{D},
\end{align}
where the fields obey the constitutive relations $\vect{D}=\epsilon\vect{E}$, $\vect{H}=\mu\vect{B}$.

Here we will ignore the frequency dependence and dispersion.
  We are implicitly assuming a monochromatic field.
  Later, we will extend this work to handle frequency dependence in the dielectric.

% For a linear medium we can write 
% \begin{equation}
% \vect{P}(\vect x) = \epsilon_0\chi(\vect x)\vect{E}(\vect x),
% \end{equation}
% where $\vect{P}$ is the polarization and $\chi$ is the linear response function of the medium.
%   The displacement can be rewritten
% \begin{equation}
% \vect{D}(\vect x) = \epsilon_0\vect{E}+\vect{P} = 
% \epsilon_0(1+\chi(\vect x))\vect{E}(\vect x)= \epsilon_0\epsvx\vect{E}(\vect x).
% \end{equation}
The fields can be rewritten in terms of the potentials:
\begin{align}
  \vect{B} = \nabla\times\vect A\qquad 
  \vect{E} = -\nabla\phi -\partial_t\vect A,
\end{align}
which automatically satisfies two of Maxwell's equations.  
There is also another choice of potentials, which is less commonly used in physics.
In these dual potentials the fields are given by 
\begin{equation}
  \vect{D}=\nabla\times\vect{C}\qquad
  \vect{H}=-\nabla\Lambda-\partial_t\vect{C}.
\end{equation}
The gauge potentials and the dual potentials are connected via a duality transformation on the field tensor.  
The field tensor $F_{\mu\nu} = \partial_\mu A_\nu-\partial_\nu A_\mu$ is used in relativistic field theory.
The field tensor is the gauge-invariant, Lorentz-invariant object which is used to construct the Lagrangian.  
In matrix form, the field tensor is 
\begin{equation}
  F_{\mu\nu} = \left( \begin{array}{cccc}
    0 & -E_x & -E_y & -E_z\\
    E_x & 0 & B_z & -B_x\\
    E_y & -B_z & 0 & B_y\\
    E_z & B_x & -B_y & 0
\end{array}\right).
\end{equation}
The dual tensor is defined as $G_{\mu\nu}:=\varepsilon_{\mu\nu\rho\sigma}F^{\rho\sigma}$.
The Levi Civita densitiy, $\epsilon_{\mu\nu\rho\sigma}$ is the fully antisymmetric rank four tensor density;
where $\epsilon_{0123}=1$ any even permutation of indices; it picks up a negative sign for any odd permutation;
and it vanishes if any indices are repeated.  

The starting Lagrangian for electromagnetism in vacuum is 
\begin{equation}
  L=-\frac{1}{4}\int d^3\vect{x}\, F_{\mu\nu}F^{\mu\nu} = =-\frac{1}{2}\int d^3\vect{x}\, (|\vect{E}|^2-|\vect{B}|^2).
\end{equation}

Note that the fields are unchanged if we make the following gauge transformation $(\phi,\vect A)\rightarrow(\phi',\vect A')$.  
\begin{align}
  \vect A' = \vect A +\nabla\alpha\qquad
  \phi' = \phi - \partial_t\alpha
\end{align}

% The remaining two Maxwell equations are then given by
% \begin{align}
% \nabla\cdot\left[ \epsilon_0\epsvx\left(-\nabla\phi-\partial_t\vect A\right)\right] &= 0\\
% \nabla\times\nabla\times\vect A +\mu_0\epsilon_0\epsvx\partial_t\left(\nabla\phi+\partial_t\vect A\right)&=0.
% \end{align}

Now since we want to go over to quantum mechanics we must start from a Lagrangian formalism.
We will initially work with a spatially varying, but frequency independent dielectric.
\begin{align}
L &= \frac{1}{2}\int d^3r\, \big(\vect{E}\cdot\vect{D} - \vect{B}\cdot\vect{H}\big) %\\
= \frac{\epsilon_0}{2}\int\! d^3r\,\big[\epsr(\vect{r})(\nabla\phi+\partial_t\vect A)^2 - \mur(\vect{x})c^2(\nabla\times\vect A)^2\big].
\end{align}
The momentum fields conjugate to the potential fields $A^\mu = (\phi,\vect A)$ are
\begin{align}
\Pi_0 & = \frac{\delta L}{\delta (\partial_t\phi)} = 0 \label{eq:Pi0}\\
\vect{\Pi} & = \frac{\delta L}{\delta (\partial_t\vect A)} = \epsilon_0\epsr(\vect{r})(\nabla\phi+\partial_t\vect A).
\end{align}
Note that $\vect{\Pi}=-\vect{D}$, i.e. the momentum field conjugate to $\vect{A}$ is the electric displacement.
Since $\Pi_0=0$ for all times, this must be preserved, which implies a constraint. Since the constraint
equation must also be preserved, there will be a further constraint imposed on the theory.
That next constraint will turn out to be Gauss's law, which enforces conservation of electric charge. 
This will in turn provide another constraint for the Hamiltonian theory.
We will try to follow Dirac's program for dealing with constraints in quantization~\cite{Dirac1964, Dirac1966}

Ultimately, in developing the Hamiltonian formulation it is necessary to correctly account for the constraints.
We are going to follow the approach suggested by Paul Dirac in Ref.~\cite{Dirac1964, Dirac1966}, 
which is analogous to the Gupta-Bleuler formulation.
In that method the fields have canonical commutation relations imposed upon them, 
and the gauge freedom restricts the states allowed the theory.  
% Eq.~(\ref{eq:Pi0}) is a constraint on the Hamiltonian and we must check for any further constraints implied by that.
% We must take all of these into account, \emph{after} we take over the classical Poisson brackets
% over to quantum commutation relations. 

The Hamiltonian for the classical fields is given by
\begin{align}
H &= \int d^3x\,[ \Pi_0\dot{A}_0+\vect \Pi\cdot\dot{\vect A}- \mathcal{L}]\\
% & = \int d^3x \, \vect \Pi\cdot\left(\frac{\vect{\Pi}}{\epsilon_0\epsvx}-\nabla\phi\right)
% -\frac{\vect \Pi^2}{2\epsilon_0\epsr(\vect{r})} + \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2\\
& = \int d^3x\,\bigg[  \frac{\vect \Pi^2}{2\epsilon_0\epsr(\vect{r})}+ \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2
-\vect{\Pi}\cdot\nabla\phi \bigg].
\end{align}
The equations of motion can be derived from the Hamiltonian. %  In particular, the requirement that the first constraint holds 
% for all time implies 
% \begin{equation}
%   \dot{\Pi}_0 = -\frac{\delta H}{\delta \phi} = \nabla\cdot\vect{\Pi} = 0,
% \end{equation}
The other equations of motion are 

The Hamiltonian theory can be quantized by finding the Poisson bracket and promoting it to the commutator
between the fields.  However, there is the matter of the constraints.  We will follow the Gupta-Bleuler
prescription which restricts the allowed quantum states to those that obey the constraints.  

In the Dirac formulation for handling constraints, the commutator is now the Poisson bracket augmented by the 
Poisson brackets between the constraints.  Such equations are said to only hold weakly, and all constraint terms should be retained until
the end of the calculation.  Only at the end should the constraints be set to zero.  
For the example of QED in free space see Dirac's treatment~\cite{Dirac1966}, or Ch. in Weinberg~\ref{Weinbergvol2}.

The Poisson bracket in 4-vector notation follows from the choice that $A^\mu = (\phi,\vect A)$.
This implies that the momentum conjugate to $A^\mu$ is given by
\begin{equation}
\Pi_\mu = \frac{\partial \mathcal L}{\partial \dot{A}^\mu}.
\end{equation}
(Note that in this initial classical treatment, we will work in Minkowski space with metric $\eta_{\mu\nu}=\text{diag}(-1,1,1,1)$.)
The Poisson bracket for fields is 
\begin{equation}
  [F_\mu(\vect{x}),G_\nu(\vect{x'})] = \sum_\alpha\int d\vect{y}\bigg[
  \frac{\delta F_\mu(\vect{x})}{\delta A^\alpha(\vect{y})}\frac{\delta G_\nu(\vect{x'})}{\delta \Pi_\alpha(\vect{y})}
  -\frac{\delta G_\mu(\vect{x'})}{\delta A^\alpha(\vect{y})}\frac{\delta F_\nu(\vect{x})}{\delta \Pi_\alpha(\vect{y})}\bigg],
\end{equation}
where we have used $\Pi_\mu$ is conjugate to $A^\mu$.
This is the straightforward generalization of the standard particle mechanics Poisson bracket.
The Poisson bracket between the fields and momenta is
\begin{align}
[A_\mu(\vect{x}),\Pi_\nu(\vect{x'})]%  &= \sum_\alpha\int d\vect{y}  \bigg[
% \frac{\delta A_\mu(\vect{x})}{\delta A^\alpha(\vect{y})}\frac{\delta \Pi_\nu(\vect{x'})}{\delta \Pi_\alpha(\vect{y})}\\
% & = \sum_\alpha\int d\vect{y}g_{\mu \alpha}\delta^{\nu}_\alpha\delta(\vect{x'-y})\delta(\vect{x-y})\bigg]
= \eta_{\mu \nu}\delta(\vect{x-x'}).  
\end{align}
In the quantum theory, the Poisson bracket between the fields goes over to the commutator between the field operators.  

%\subsection{Constraints}
Now we need to consider the constraints.
%  We will use Paul Dirac's scheme for dealing with the constraints.
  We need to ensure that the constraints are obeyed at all times 
--- which requires that all of the Poisson brackets with the Hamiltonian should vanish.
   We should also consider the Poisson brackets of those constraints until we have exhausted 
all of the conditions implied by the constraint.  
From Eq.~\ref{eq:Pi0}, we have $\Pi_0 = 0$.  This in turn implies that 
\begin{equation}
\partial_t\Pi_0 = [\Pi_0,H ] =-\frac{\delta H}{\delta \phi} = \nabla\cdot\vect{\Pi} = 0, 
\end{equation}
which is Gauss's law in the absence of charges.
% So we also have the constraint that $\nabla\cdot\vect{\Pi} = 0$.
% Coulomb's law emerges as a constraint on the fields.  

We can equally well write the Hamiltonian as 
\begin{align}
  H& = \int d^3r\bigg[\frac{\vect{\Pi}^2}{2\epsilon_0\epsr(\vect{r})}+\phi(\nabla\cdot\vect{\Pi})
+ \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2 + f\Pi_0 + g(\nabla\cdot\vect{\Pi})\bigg]
\end{align}
where $f$ and $g$ are arbitrary functions.  In this case $f$ and $g$ serve as arbitrary or gauge degrees of freedom.
%  Since the constraints must be satisfied this is equivalent to adding zero.
%  I don't think this means anything for us - this is just a manifestation of the gauge freedom of the electromagnetic field.  
%  These constraints serve as the generators of gauge transformations.  

\section{Quantum Theory}

To pass over to the quantum theory, we take the Poisson brackets over to commutation relations 
between operators and impose the constraints on the states we allow in the theory.
In the Gupta-Bleuler formalism, one restrict the states allowed in the theory to obey the constraints,
rather than the operators.  

The equal-time commutation relations are now 
\begin{equation}
[A_\mu(\vect{x},t),\Pi_\nu(\vect{x'},t)] = i\hbar \eta_{\mu\nu}\delta^{3}(\vect{x-x'}),
\end{equation}
and the allowed states must obey:
\begin{equation}
\hat{\Pi}_0|\Psi\rangle = 0, \quad \nabla\cdot\hat{\Pi}|\Psi\rangle = 0.
\end{equation}
When we insert identities we will use 
\begin{align}
V_\mathrm{gauge} &= \int d^3\vect A d\phi\,|\phi,\vect A\rangle\langle \phi,\vect A|\\
1 &= \int d^4\Pi\, |\vect{\Pi}\rangle\langle\vect{\Pi}|\delta(\nabla\cdot\vect{\Pi})\delta(\Pi_0) 
= \int d^3\vect{\Pi}\, |\vect{\Pi}\rangle\langle\vect{\Pi}|\delta(\nabla\cdot\vect{\Pi})
\end{align}
% The volume shows up because we are integrating over equivalent physical states that are related by gauge transformations.
%   We won't care about this, since the volume only adds a constant to the energy.
  The delta function in the momentum states ensures that we only include states that obey the constraints.
%  We are ignoring any determinant that arising from changing measure, or rather assuming that it is already correctly accounted for.  

The delta function can be written in the Fourier representation as 
\begin{equation}
\delta(\nabla\cdot\vect{\Pi}) = \int D\varphi \exp\left[-\frac{i}{\hbar}\int d^3x 
  \varphi(\vect x)\nabla\cdot\vect{\Pi}(\vect x)\right],
\end{equation}
where the factor of $\hbar$ is put there for later convenience.  

Since the fields and momenta obey canonical commutation relations, and the states are restricted so that 
$\hat{\Pi}_0|\Psi\rangle = 0$, the overlap between field and momentum states is
\begin{equation}
\langle \phi,\vect A | \Pi_0,\vect{\Pi} \rangle = \exp\left[-\frac{i}{\hbar}\int d^3x\, \vect A\cdot\vect{\Pi}\right].
\end{equation}

\section{Electromagnetic Partition Function}

Ultimately we want to evaluate the ground state energy, which requires that we evaluate the partition function 
\begin{equation}
Z\subEM = \mathrm{Tr}[e^{-\beta \op{H}}] = \int d\phi_0 d\vect A_0 \langle \phi_0,\vect A_0|e^{-\beta \op{H}}|\phi_0,\vect A_0\rangle.
\end{equation}
In analogy with the path integrals described in Ch.~\ref{ch:introduction}, this is can be converted 
into a path integral --- a sum over all possible field configurations evolving in imaginary time 
$\beta = i\tau$.  In this case, at each step there is also a delta-function restricting the allowed momentum states.
The path integral is given by
\begin{align}
Z & = \int d\phi d\vect A \langle \phi,\vect A|e^{-\beta \hat{H}}|\phi,\vect A\rangle %\\
 = \int d\phi d\vect A \langle \phi, \vect A| \prod_{i=1}^{N}e^{-d\beta\hat{H}}|\phi,\vect A\rangle,
\end{align}
where $d\beta = \beta/N$.
Now we insert $(N-1)$ factors of the gauge volume between each factor of $e^{-d\beta\hat{H}}$.  
% \begin{equation}
% Z  = \prod_{i=1}^N\int d\phi_id\vect A_i \delta(\vect A_N-\vect A_0)\delta(\phi_N-\phi_0)
% \langle \phi_i,\vect A_i|e^{-d\beta\hat H}|\phi_{i-1},\vect A_{i-1}\rangle,
% \end{equation}
% where we have defined $A^\mu_N=A^\mu_0=A^\mu$.
%   Now we note that each $A_i$ corresponds to a particular temperature range, 
% so we can write $A_i = A_{\beta+d\beta}$ and $A_{i-1}=A_\beta$.  
Next we insert the identity for the momentum states between each matrix element.
  We focus our attention on a particular slice of matrix elements:
% \begin{align}
% \langle \phi_{\beta+d\beta}\vect A_{\beta+d\beta}| e^{-d\beta \hat{H}}|\phi_\beta, \vect A_\beta\rangle %\\
% % & = \int d\Pi_0 d\vect{\Pi}_\beta\,\delta(\Pi_0)\delta(\nabla\cdot\vect{\Pi}_\beta)
% % \langle \phi_{\beta+d\beta},\vect A_{\beta+d\beta}|\Pi_{0,\beta} \vect{\Pi}_\beta\rangle 
% % \langle \Pi_{0,\beta}\vect{\Pi}_\beta|\exp[-d\beta \hat{H}]|\phi_\beta,\vect A_\beta\rangle\\
% & = \int d\vect{\Pi}_\beta\,\delta(\nabla\cdot\vect{\Pi}_\beta)
% \langle \vect A_{\beta+d\beta}| \vect{\Pi}_\beta\rangle
% \langle \vect{\Pi}_\beta|\exp[-d\beta \hat{H}]|\vect A_\beta\rangle.
% \end{align}
Since $\Pi_0$ is contrained to vanish, we can carry out that integral immediately, and focus on the other
components of the momentum field.

Using the Fourier representation of the delta function, we can write one of those matrix elements as 
\begin{align}
\langle \phi_{\beta+d\beta}\vect A_{\beta+d\beta}| e^{-d\beta \hat{H}}|\phi_\beta, \vect A_\beta\rangle
=
% \int\! d\vect{\Pi}_\beta \int\! D\varphi_\beta\exp\bigg[ \int d^3x \,
% -\frac{i}{\hbar}\varphi_\beta(\nabla\cdot\vect{\Pi}_\beta) +\frac{i}{\hbar}\left(\vect A_{\beta+d\beta}
% -\vect A_{\beta}\right)\cdot\vect{\Pi}_\beta  -d\beta\left( \ frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsr(\vect{r})}
% +\frac{1}{2}\epsilon_0c^2(\nabla\times \vect A_\beta)^2\right)\bigg]\\
& \int\! d\vect{\Pi}_\beta \int\!D\varphi\,e^{ -d\beta\int d^3x 
\big[ \mathcal{H}_\beta-i\vect{\Pi}_\beta\cdot(\partial_\beta \vect A_\beta + \nabla\varphi_\beta)/\hbar 
\big]},
\end{align}
where
\begin{align}
  \mathcal{H}_\beta = \frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsr(\vect{r})} +\frac{1}{2}\epsilon_0c^2(\nabla\times \vect A_\beta)^2
\end{align}
%   We will be subtracting off the vacuum energy, so we will be sloppy over keeping track of any constant normalization factors.
%   We will need to be careful over constants with position dependence, 
% but overall factors of $\pi, c,\text{etc.}$ are irrelevant. 
 We have also integrated by parts on the term coming from the Fourier representation of the delta function.
  In addition we have identified 
\begin{equation}
  \partial_\beta\vect A_\beta=\frac{\vect A_{\beta+d\beta}-\vect A_\beta}{d\beta}.
\end{equation}
The momentum integrals are Gaussian, and can be carried out immediately, with the result that
\begin{multline}
\langle \phi_{\beta+d\beta}\vect A_{\beta+d\beta}| \exp[-d\beta \hat{H}]|\phi_\beta, \vect A_\beta\rangle\\
%  \int\! d\vect{\Pi}_\beta \exp\left[ -d\beta\int d^3x \frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsr(\vect{r})} 
% -\frac{i}{\hbar}\vect{\Pi}_\beta\cdot(\partial_\beta \vect A_\beta - \nabla\varphi_\beta) \right] 
\propto   \det[\epsr(\vect{r})]^{3/2}\exp \left\{ -\frac{\epsilon_0d\beta}{2\hbar^2}
  \int d^3x\,\bigg[ \epsr(\vect{r})(\partial_\beta \vect A_\beta - \nabla\varphi_\beta)^2
  +\frac{1}{2}\epsilon_0c^2(\nabla\times \vect A_\beta)^2\bigg]\right\}.
\end{multline}
Initially I missed the factor of $\epsr(\vect{r})^{3/2}$, which I discovered by reading a paper by
 Bordag on path integral quantization in dielectric media \cite{Bordag1998}.

% We are integrating over all field configurations, and at all points in space.
We will introduce a notation
\begin{equation}
\int D \vect{A} D\varphi |\epsr(\vect{r})|^{3/2} = \prod_{i=1}^N\prod_{x_k}\int d\vect{A}(\vect{x}_k,\beta)
\int d\varphi(\vect{x}_k,\beta)\det[\epsilon^{3/2}(\vect{x}_k)],
\end{equation}
where the product $\vect{x}_k$ runs over all positions $\vect{x}\in \mathbb{R}^3$  and ranges of $\beta'\in[0,\beta)$.  

If we take the product of all of the matrix elements, then the total path integral is given by 
% \begin{equation}
% Z = \int D\vect A D\varphi\, \epsr(\vect{r})^{3/2}\exp\left[-\frac{\epsilon_0}{2\hbar^2}\int d^3x\int_0^\beta d\beta\,
% \epsr(\vect{r})\left(\partial_\beta\vect A-\nabla\varphi\right)^2+\hbar^2c^2(\nabla\times\vect A)^2\right].  
% \end{equation}
We can change variables to $x_4=\beta\hbar c$, and $A_4 = \varphi/\hbar c$, and rescale all of the fields
to eliminate the constants out front.  These rescaling cancel out under renormalization anyway. 
%Note that $A_4$ has the same dimensions as $\vect{A}$.
We can also see that $x_4$ is proportional to the thermal de-Broglie wavelength, up to a factor of $2\pi$.  
\begin{equation}
Z = \int D^4A\, \epsr(\vect{r})^{3/2}\exp\left\{-\frac{1}{2}\int d^3r\int_0^{\beta\hbar c}\hspace{-0.25cm} dx_4\,
 \bigg[ \epsr(\vect{r})\left(\partial_4\vect A-\nabla A_4\right)^2+\frac{1}{\mu_r(\vect{r})}(\nabla\times\vect A)^2\bigg]\right\}.
\end{equation}
We will compare this partition function to the case when the objects are infinitely far apart,
 which we will denote as $Z_0$.
The objects will still be present in the space, but they will be too far away to interact significantly.  

We can write the $\epsr(\vect{r})$ term as a functional determinant,
 since it is a product, $\det|\epsr(\vect{r})|=\prod_{r_k}\epsr(r_k)$.
 If we move the objects far apart from each other, 
 the $\epsr$-determinant will not change value since we are assuming the amount of material 
 $\epsilon$ is constant.  
 Ultimately we will calculate energies from the partition function.  In the zero temperature limit
\begin{equation}
E-E_0 = -\lim_{\beta\rightarrow 0}\frac{1}{\beta} \log Z-\log Z_0.
\end{equation}
Since the constants $\det\epsilon$ will be the same in both cases, these will cancel out under this 
renormalization.
We can then ignore drop these constant determinants and consider 
\begin{equation}
  Z = \int D^4A\, \exp\left[-\frac{1}{2}\int d^4x\,
  \epsr(\vect{r})\left(\partial_4\vect A-\nabla A_4\right)^2+(\nabla\times\vect A)^2\right].
\end{equation}
\comment{also dropped A0 integrals}

At this point Bordag\etal~\cite{Bordag1998} rescale the fields to handle the functional determinant
in $\epsr$.  (The goal of that paper seems to be to examine the divergence structure of the theory,
at a very formal level, rather than the straightforward energy calculation we wish to carry out.)
As suggested above, the rescaling is not strictly necessary.  

The filed path integral can be written in terms of the Euclidean action,
 \begin{equation}
 Z = \int D\vect{A} D\phi e^{-S_E[\vect{A},A_4]},
 \end{equation}
where the Euclidean action is 
\begin{equation}\label{eq:euclidean_action}
S_E[\vect{A},\phi] = \frac{1}{2} \int d^4x\, \bigg[
\epsr(\vect{r})\left( \partial_4\vect{A}-\nabla A_4\right)^2
+\vect{A}\cdot\nabla\times\frac{1}{\mu_r(\vect{r})}\nabla\times\vect{A}\bigg].
\end{equation}
% This change of variable was necessary after the integral over the conjugate momentum fields.
% We have already used all of the constraints on the fields to write the equations in this form. 
% We are using the euclidean path integral, with $x_4=\beta$.

\subsection{Fadeev-Popov Gauge Fixing}

We need to enforce a gauge condition, since currently the path integral runs over all field configurations.
The integral includes physically equivalent states that are related to each other by a gauge transformation.
We will then only integrate over one point from the gauge fibre by enforcing a delta-function constraint.  

The gauge transformation can be written as 
\begin{equation}
A^\mu \rightarrow A^\mu +\partial^\mu\alpha,
\end{equation}
where $\alpha$ is an arbitrary function.
This change of variables does not change the value of the path integral, and it will yield divergent 
results if it is not removed from the path integral.  
In order to extract finite results from the path integral, it is necessary to restrict this gauge degree of freedom.
This gauge-fixing is carried out by introducing a gauge-fixing function $G[A]$ inside a functional $\delta$-function.

The Jacobian factor associated with the gauge-fixing can be constructed in analogy
 with the change of variable for a single delta function:
\begin{equation}
\int dx\, \delta[f(x)] = \int df \frac{1}{|\partial_xf|}\delta(f).
\end{equation}
In order to fix the gauge, and assign each state equal weight, the inverse Jacobian factor should be introduced
alongside the functional $\delta$-function.  
One further trick is often used in gauge-fixing the path integral.  Instead of fixing a gauge with
$G[A]=0$, an alternative gauge $G[A]=\gamma$ can be used.  Since $\gamma$ is an otherwise free parameter,
we can integrate it against a Gaussian density,
\begin{equation}
  1 = \int D\gamma \exp\left[-\frac{1}{2}\int d^4x\,\gamma^2(x)\right].
\end{equation}
Such factors are unity in the path integral sense that any constants will cancel out when considering
physical energies, which require renormalization.
Finally, the gauge-fixed partition function is
\begin{align}
 Z &= \int D\vect{A} DA_4 D\gamma \delta[G[A]-\gamma]\det\bigg[\frac{\delta G}{\delta \alpha} \bigg]
 \exp\left[-S_E-\frac{1}{2}\int d^4x\, \gamma^2(x)\right]\nonumber\\
 &= \int D\vect{A} DA_4\det\bigg[\frac{\delta G}{\delta \alpha} \bigg]
 \exp\left[-S_E-\frac{1}{2}\int d^4x\, G^2\right],
\end{align}
where we carried out the integral over $\gamma$ in the second equality.  
%  For non-Abelian field theories, the functional determinant is often turned into an integral over 
%  anti-commuting Grassman variables \cite{Srednicki2008}.  This allows the Feynman rules to be extended
% to account for the gauge-fixing, since the gauge transformation is non-linear in the fields.  
  For electromagnetism, since the gauge transformation is independent of the fields,
  the gauge-fixing functional determinant is also independent of the fields.
  Nonetheless, we need to keep track of this determinant to correctly count the degrees of freedom,
  and it depends on the material properties of the interacting bodies, so we cannot ignore it in all cases.

\subsection{Gauge Choices}
Overall, physical results should be independent of our choice of gauge,
 and it would be nice to show that you get the same results in two different gauges.
There are a number of gauges available, only some of which are suited to the path integral.  %  I have come across the following gauge choices:

Coulomb gauge ($\nabla\cdot\vect A=0$) is the familiar choice in non-relativistic quantum optics, since in free space 
it decouples the scalar potential decouples from the vector potential, which then only has two transverse degrees of freedom.
However, in the presence of a spatially dependent dielectric, this is no longer true and this gauge couples $\vect A$ to $A_4$.
So-called generalized Coulomb Gauge ($\nabla\cdot\epsilon\vect A=0$) does remove that coupling, 
  and is in fact the choice used in other attempts to quantize the EM field inside 
  a dielectric~\cite{Knoell1987, Glauber1991}.
  % This choice removes any coupling between $\vect{A}$ and $A_4$.
  % As can be seen from the equations of motion.
  % The functional determinant then depends on $\epsilon$, so we should track it.
  Unfortunately, this is not susceptible to the above gauge-fixing techniques.
  Generalized Lorenz gauge solves that issue, and is how we have proceeded.  

Another popular gauge is Weyl or temporal gauge where the scalar potential vanishes, $A_4=0$.
This gauge simply removes the scalar field, and rolls all of that dependence into the longitudinal part of $\vect A$.
This gauge is not a complete gauge fixing, since there are still gauge transformations from fields independent of $\beta$.
Surprisingly, this does seem to be a fairly common gauge for people working with path integrals in dielectrics~\cite{Bechler1999,Rahi2009}.
However, it is not a complete gauge fixing so we will not pursue it any further.  

Finally, there is a generalized Lorenz gauge
$\frac{1}{\epsilon}\nabla\cdot\epsilon\vect A + \epsilon\partial A_4=0$, 
introduced by Bordag\etal\cite{Bordag1998}.  This gauge allows the derivation to proceed in close parallel
with the case with no media\footnote{A similar gauge was fixed by Reid\etal\cite{Reid2013} in their development of the 
  numerical scattering method.  However, that work explicitly relies on fixing electromagnetic boundary conditions at surfaces.
That work then proceded using \emph{homogeneous} formula for all quantities and ignoring any singularities 
arising at interfaces.  
In work on the worldline, it is more natural to keep these singularities, anticipating that they will act as effective boundary conditions.
}
This gauge removes any coupling between the scalar and vector degrees of freedom.  In addition, 
once the gradients have been expanded out in the path integral, the leading terms have no $\epsilon$-dependence,
which makes worldline calculations simpler.  
However, Bordag\etal found the disquieting feature that the longitudinal and scalar degrees of freedom do not
cancel out the ``ghost'' degrees of freedom~\cite{Bordag1998}.  A later calculation adapted to spherical
geometries found that using the dual potentials led to more physical results, at least when $\epsr-1$ is small.
This perhaps suggests that quantizing and gauge-fixing 
the effective field theory has problems, and it may be better to proceed directly via linear-response theory.
The resulting functional determinant from gauge-fixing depends on $\epsilon$, so we cannot drop the determinant.  

% \item Generalized Lorenz Gauge: $\nabla\cdot\epsilon\vect A + \partial A_4=0$.
%   This removes the coupling between $\vect{A}$ and $A_4$.
%   It's form is chosen to cancel the cross term in the first quadratic piece of Eq. (\ref{eq:euclidean_action}).
%   It also gives the same functional determinant as the $A_4$ integral, which allows a partial cancellation of terms.  
% \end{enumerate}

% There is a perplexing array of gauge-fixings available to us in this computation.
% Even with the requirements that the leading coeffients be free-space-like, and the coupling between
% the scalar and vector fields cancel, there is still a residual freedom in fixing gauge.  

% \section{Gauge-Fixing: Generalized Lorenz Gauge}

% Of these gauges, the generalized Lorenz gauge is best suited to the full gauge theory path integral.  
% (In later work on the scalar path integrals in planar geometries, Coulomb gauge can be used to naturally.)

% We will enforce a generalized Lorenz gauge,
% \begin{equation}
%   G[A]=\frac{1}{\epsr(\vect{r})\sqrt{\mur(\vect{r})}}\nabla\cdot\epsr(\vect{r})\vect{A}+\epsr(\vect{r})\sqrt{\mur(\vect{r})}\partial_4A_4 = 0,
% \end{equation}
% which elminates the cross coupling between the $A_4$ and the vector potential $\vect{A}$; it also eliminates
% the longitudinal projector part of $(\partial_iA_i)^2$, at the cost of extra terms involving derivatives of the 
% dielectric.  

% To carry out the Faddeev-Popov gauge fixing, we need the functional derivative
% of the gauge-fixing function with respect to gauge transformations:
% The functional derivative can be read off as the linear term in $\alpha$ after  making a gauge transformation on the gauge condition,
% \begin{equation}
%   G[A^\mu+\partial^\mu \alpha] = \frac{1}{\epsr(\vect{r})}\nabla\cdot[\epsr(\vect{r})(\vect{A}+\nabla\alpha)].
%   +\epsr(\vect{r})\partial_4(A_4+\partial_4\alpha).
% \end{equation}
% % \begin{equation}
% % \frac{\delta G}{\delta \alpha} = \frac{1}{\epsr(\vect{x})}\nabla\cdot\epsr(\vect{x})\nabla + \epsr(\vect{r})\partial_4^2.
% % \end{equation}
% The Euclidean action (\ref{eq:euclidean_action}) after gauge-fixing, cancelling terms, and integrating-by-parts, becomes 
% \begin{align}
%   S_E &=\frac{1}{2}\int d^3r d\tau\,\bigg[ A_4L^{(4)}A_4   +A_iL^{(V)}_{ij}A_j \bigg],
% \end{align}
% where we have momentarily suppressed the spatial arguments of the dielectric functions, and started using the 
% Einstein summation convention (where repeated latin and greek indices are summed over).
% The operators $L^{(4)}$ and $L^{(V)}_{ij}$ are given by 
% \begin{align}
%   L^{(4)} &=-\epsr^2\mur\partial_\tau^2-\partial_k\epsr\partial_k\\
%   L^{(V)}_{ij} &=-\epsr\partial_\tau^2\delta_{ij}-\partial_k\cdot\frac{1}{\mur}\partial_k\delta_{ij}+\partial_j\frac{1}{\mu_r}\partial_i
%   -\epsr\partial_i\frac{1}{\epsr^2\mur}\partial_j\epsr.
% \end{align}

% \comment{Multiplicative anomaly}\footnote{
% Even greater care is required in treating matrix functional determinants of matrix differential operators.
% While $\det(AB)=\det(A)\det(B)$ for finite matrices, for infinite matrices, there is a regularization
% factor, known as the ``multiplicative anomaly''.
% This is important for so-called $\zeta$-function regularization, which is closely allied with the worldline method.
% }

% At this point, we choose to rescale the fields, 
% \begin{equation}
%   A_4=: \frac{1}{\sqrt{\epsr}}\tilde{A}_4, \qquad \vect{A}=\sqrt{\mur}\tilde{\vect{A}}.
% \end{equation}
% These field scalings are chosen to simplify the worldline path integrals.  
% In the worldline path integral, operators like $\partial_x^2$ lead to Gaussian probability densities, while
% % it is simplest to handle differential operators like $-partial_x^2$ instead of $\partial_x\epsilon\partial_x$,
% % since the latter yields a Gaussian probability density.
% The operators like $\partial_x\epsilon\partial_x$ will lead to a non-Gaussian probability density, which is
% harder to numerically sample from.
% In rescaled form, operators $\epsr^{-1/2}\partial_x\epsr\partial_x\epsr^{-1/2}\rightarrow \partial_x^2+V$,
% where $V$ arises from commuting spatially-dependent dielectric functions past the derivatives.
% The cost of field rescaling is that extra potential terms arise, but this might be more tractable.  
% The field rescaling also leads to functional determinants $|\mur|,|\epsr|$, but these cancel out under
% renormalization.  


% The Gaussian integrals can at least be formally carried out, with the result that 
% % The term in $\tilde{A}_4$ can be rewritten as 
% % \begin{equation}
% % \int d^4x [\partial_4A_4]^2+\epsilon|\nabla A_4|^2 = \int d^4x\, A_4\left(-\nabla\cdot\epsilon\nabla-\partial_4^2\right)A_4,
% % \end{equation}
% % at the cost of some boundary terms which are assumed to vanish.  
% % \begin{align}
% %  \int D \tilde{A}_4 &\exp\left[-\int d^4x \,\tilde{A}_4\left(
% % -\frac{1}{\sqrt{\epsr}}\nabla\cdot\epsr\nabla\frac{1}{\sqrt{\epsr}}-\espr\mur\partial_4^2\right)\tilde{A}_4\right] \nonumber\\
% % &\propto \det{}^{-1/2}
% % \left(-\epsr\mur\partial_4^2-\frac{1}{\sqrt{\epsr}}\nabla\cdot\epsr\nabla\frac{1}{\sqrt{\epsr}}\right).
% % \end{align}
% % which is similar, but not identical to the term in the Faddeev-Popov determinant.
% %   This result follows from thinking about the following finite dimensional Gaussian integral,
% % \begin{align}
% % \int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] = \int d\vect{z} \det[O] \exp[-\vect{z}^TO^TMOz]
% % \end{align}
% % If we assume $M$ is Hermitian, we can find its eigenvalues and eigenvectors.
% %   If we choose $O$ to diagonalize $M$, we have decomposed $\vect{y}$ into the eigenvectors of $M$.
% %   This is an orthogonal transformation, and the determinant $\det O$ is unity.
% %   The eigenvectors are orthogonal, so they decouple and the integral becomes a product of simple Gaussian integrals.   
% % \begin{align}
% % \int d\vect{z}\exp[-\vect{z}^T\varphi\vect{z}]=\prod_k\int dz_k \exp[ -\lambda_kz_k^2] =  \prod_k \sqrt{\frac{\pi}{\lambda_k}},
% % \end{align}
% % where we have defined the diagonal matrix $\varphi=O^TMO$.
% %    The determinant of $\varphi$ is just the product of its diagonal elements - which is exactly what we found as the result of the integral.  We can now invert the orthogonal transformations to write 
% % \begin{equation}
% % \int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] \propto \det{}^{-1/2}M
% % \end{equation}

% % \begin{align} \int d^3\vect{x}\,
% % \bigg[\left(\nabla\times\frac{\vect{A}}{\sqrt{\epsilon}}\right)^2
% % +(\nabla\cdot\sqrt{\epsilon}\vect{A})^2 &= 
% % \int d^3\vect{x}\,A_i\left[
% %   -\frac{1}{\sqrt{\epsilon}}(\delta_{ij}\nabla^2-\partial_i\partial_j)\frac{1}{\sqrt{\epsilon}}
% %   -\sqrt{\epsilon}\partial_i\partial_j\sqrt{\epsilon} \right] A_j
% % \end{align}
% So the partition function now becomes:
% \begin{align}
% Z%  &= \int D\vect{A} DA_4\, \det[-\partial_4^2-\nabla\cdot\epsilon\nabla]
%  % \exp\left[-\int d^4x \mathcal{L}\right]\\
% &\propto\det\left[\left(-\epsr\mur\partial_4^2-\frac{1}{\sqrt{\epsr}}\nabla\cdot\epsr\nabla\frac{1}{\sqrt{\epsr}}\right)\right]^{1/2}
% \det\left[-(\epsr\mur\partial_4^2+\nabla^2)\delta_{ij}-V_\mu
%  + \frac{1}{\sqrt{\epsilon}}\partial_i\partial_j\frac{1}{\sqrt{\epsilon}}
% -\sqrt{\epsilon}\partial_i\partial_j\sqrt{\epsilon} \right]^{-1/2},
%  \end{align}
% where $C$ absorbs all of the constant pieces.  


\section{Gauge-Fixing: Generalized Lorenz Gauge}

Of these gauges, the generalized Lorenz gauge is best suited to the full gauge theory path integral.  
(In later work on the scalar path integrals in planar geometries, Coulomb gauge can be used to naturally.)

At this point, we will start using the Einstein summation convention,  repeated indices imply a sum.

\comment{SET $\mu=1$.  UTTERLY HORRENDOUS OTHERWISE}

We will enforce a generalized Lorenz gauge,
\begin{equation}
  G[A]=\frac{1}{\epsr(\vect{r})}\nabla\cdot\epsr(\vect{r})\vect{A}+\epsr(\vect{r})\partial_4A_4 = 0,
\end{equation}
which elminates the cross coupling between the $A_4$ and the vector potential $\vect{A}$; it also eliminates
the longitudinal projector part of $(\partial_iA_i)^2$, at the cost of extra terms involving derivatives of the 
dielectric.  

To carry out the Faddeev-Popov gauge fixing, we need the functional derivative
of the gauge-fixing function with respect to gauge transformations:
The functional derivative can be read off as the linear term in $\alpha$ after  making a gauge transformation on the gauge condition,
\begin{align}
  G[A^\mu+\partial^\mu \alpha] &= \frac{1}{\epsr(\vect{r})}\nabla\cdot[\epsr(\vect{r})(\vect{A}+\nabla\alpha)]
  +\epsr(\vect{r})\partial_4(A_4+\partial_4\alpha)\nonumber\\
&=G[A^\mu]+\bigg[\frac{1}{\epsr(\vect{r})}\nabla\cdot[\epsr(\vect{r})\nabla+\epsr(\vect{r})\partial_4^2\bigg]\alpha).
\end{align}
The Euclidean action (\ref{eq:euclidean_action}) after gauge-fixing, cancelling terms, and integrating-by-parts, becomes 
\begin{align}
  S_E &=\frac{1}{2}\int d^3r d\tau\,\bigg[ A_4L^{(4)}A_4   +A_iL^{(V)}_{ij}A_j \bigg],
\end{align}
where we have momentarily suppressed the spatial arguments of the dielectric functions, and started using the 
Einstein summation convention (where repeated latin and greek indices are summed over).
The operators $L^{(4)}$ and $L^{(V)}_{ij}$ are given by 
\begin{align}
  L^{(4)} &=-\epsr^2\partial_\tau^2-\partial_k\epsr\partial_k\\
  L^{(V)}_{ij} &=-\epsr\partial_\tau^2\delta_{ij}-\partial_k\partial_k\delta_{ij}+\partial_j\partial_i
  -\epsr\partial_i\frac{1}{\epsr^2}\partial_j\epsr.\label{eq:matrix_operator_A}
\end{align}


At this point, we choose to rescale the scalar field, 
\begin{equation}
  A_4=: \frac{1}{\sqrt{\epsr}}\tilde{A}_4.
\end{equation}
These field scalings are chosen to simplify the worldline path integrals.  
In the worldline path integral, operators like $\partial_x^2$ lead to Gaussian probability densities, while
% it is simplest to handle differential operators like $-partial_x^2$ instead of $\partial_x\epsilon\partial_x$,
% since the latter yields a Gaussian probability density.
The operators like $\partial_x\epsilon\partial_x$ will lead to a non-Gaussian probability density, which is
harder to numerically sample from.
In rescaled form, operators $\epsr^{-1/2}\partial_x\epsr\partial_x\epsr^{-1/2}\rightarrow \partial_x^2+V$,
where $V$ arises from commuting spatially-dependent dielectric functions past the derivatives.
The cost of field rescaling is that extra potential terms arise, but this might be more tractable.  
The field rescaling also leads to functional determinants $|\mur|,|\epsr|$, but these cancel out under
renormalization.  
The differential operators between the rescaled field $\tilde{A}_4$ is
\begin{equation}
  \tilde{L}_4 = -\epsr\partial_\tau^2-\frac{1}{\sqrt{\epsr}}\partial_k\epsr\partial_k\frac{1}{\sqrt{\epsr}}.\label{eq:scalar_operator}
\end{equation}
The combination of functions of the form $f^{-1/2}(x)\partial_if(x)\partial_jf^{-1/2}(x)$,will recur multiple 
times in handling worldline path integrals.  This can be written out as a second derivative with an
additional potential in terms of derivatives of $F_i:=\partial_i\log\sqrt{f}$.
The derivatives can be expanded out as follows,
\begin{align}
  [f^{-1/2}(x)\partial_if(x)\partial_jf^{-1/2}(x)]\psi &= (f^{-1/2}(x)\partial_if^{1/2})( f^{1/2}\partial_jf^{-1/2})\psi\nonumber\\
  &= (F_i+\partial_i)(-F_j+\partial_j)\psi\nonumber\\
  &= [-F_iF_j+(\partial_iF_j)-F_j\partial_i+F_i\partial_j+\partial_i\partial_j]\psi,
\label{eq:TM_potential_derivatives}
\end{align}
for an unspecified function $\psi$. The $\partial_i F_j$ term is understood as a function rather than a differential
operator, while the other derivatives are still operators acting to the right.  
This result is needed in both the scalar and matrix differential operators.  

The Gaussian integrals can at least be formally carried out, with the result that 
% The term in $\tilde{A}_4$ can be rewritten as 
% \begin{equation}
% \int d^4x [\partial_4A_4]^2+\epsilon|\nabla A_4|^2 = \int d^4x\, A_4\left(-\nabla\cdot\epsilon\nabla-\partial_4^2\right)A_4,
% \end{equation}
% at the cost of some boundary terms which are assumed to vanish.  
% \begin{align}
%  \int D \tilde{A}_4 &\exp\left[-\int d^4x \,\tilde{A}_4\left(
% -\frac{1}{\sqrt{\epsr}}\nabla\cdot\epsr\nabla\frac{1}{\sqrt{\epsr}}-\espr\mur\partial_4^2\right)\tilde{A}_4\right] \nonumber\\
% &\propto \det{}^{-1/2}
% \left(-\epsr\mur\partial_4^2-\frac{1}{\sqrt{\epsr}}\nabla\cdot\epsr\nabla\frac{1}{\sqrt{\epsr}}\right).
% \end{align}
% which is similar, but not identical to the term in the Faddeev-Popov determinant.
%   This result follows from thinking about the following finite dimensional Gaussian integral,
% \begin{align}
% \int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] = \int d\vect{z} \det[O] \exp[-\vect{z}^TO^TMOz]
% \end{align}
% If we assume $M$ is Hermitian, we can find its eigenvalues and eigenvectors.
%   If we choose $O$ to diagonalize $M$, we have decomposed $\vect{y}$ into the eigenvectors of $M$.
%   This is an orthogonal transformation, and the determinant $\det O$ is unity.
%   The eigenvectors are orthogonal, so they decouple and the integral becomes a product of simple Gaussian integrals.   
% \begin{align}
% \int d\vect{z}\exp[-\vect{z}^T\varphi\vect{z}]=\prod_k\int dz_k \exp[ -\lambda_kz_k^2] =  \prod_k \sqrt{\frac{\pi}{\lambda_k}},
% \end{align}
% where we have defined the diagonal matrix $\varphi=O^TMO$.
%    The determinant of $\varphi$ is just the product of its diagonal elements - which is exactly what we found as the result of the integral.  We can now invert the orthogonal transformations to write 
% \begin{equation}
% \int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] \propto \det{}^{-1/2}M
% \end{equation}

% \begin{align} \int d^3\vect{x}\,
% \bigg[\left(\nabla\times\frac{\vect{A}}{\sqrt{\epsilon}}\right)^2
% +(\nabla\cdot\sqrt{\epsilon}\vect{A})^2 &= 
% \int d^3\vect{x}\,A_i\left[
%   -\frac{1}{\sqrt{\epsilon}}(\delta_{ij}\nabla^2-\partial_i\partial_j)\frac{1}{\sqrt{\epsilon}}
%   -\sqrt{\epsilon}\partial_i\partial_j\sqrt{\epsilon} \right] A_j
% \end{align}
So the partition function now becomes:
\begin{align}
Z%  &= \int D\vect{A} DA_4\, \det[-\partial_4^2-\nabla\cdot\epsilon\nabla]
 % \exp\left[-\int d^4x \mathcal{L}\right]\\
&\propto
\det\left[-\frac{1}{2}(\epsr\partial_4^2+\nabla^2)+V_4\right]^{-1/2}\nonumber\\
&\times\det\left[-\frac{1}{2}(\epsr\partial_4^2+\nabla^2)\delta_{ij} -u_{ij} +V^{(A)}_{ij}
 \right]^{-1/2}\nonumber\\
&\times\det\left[-\frac{1}{2}(\epsr\partial_4^2+\nabla^2)-\frac{1}{2}(\nabla\log\epsr)\cdot\nabla \right]
 \end{align}
where the first determinant comes from the scalar potential path integral, the second comes from
the vector potential, and the final determinant comes is the Faddeev-Popov gauge-fixing determinant.
The potentials $V_4$ and $V^{(A)}_{ij}$, and the operator $u_{ij}$, are defined as 
\begin{subequations}
\begin{align}
  V_4 & = \frac{1}{2}|\nabla\log\sqrt{\epsr}|^2-\frac{1}{2}\nabla^2\log\sqrt{\epsr}\\
  V^{(A)}_{ij} &= \frac{1}{2}|\nabla\log(\epsr^{-1})|^2-\frac{1}{2}\nabla^2\log (\epsr^{-1})\\
  u_{ij}&=\frac{1}{2}(\partial_i\log\epsr)\partial_j -\frac{1}{2}(\partial_j\log\epsr)\partial_i.
\end{align}
\end{subequations}
\comment{right signs/powers of epsilon?}
Note that these potentials are highly singular for discontinuous media.  If we model the discontinuities
with a step-function $\theta(x)$, then potentials scale as 
\begin{equation}
  [\partial_x\theta(x)]^2-\partial_x^2\theta(x)\sim \delta(x)^2 - \delta'(x),
\end{equation}
which is horrificly singular.  
These expressions must be suitable regularized by smoothing out the step, and taking the limit at 
the end of the calculation.  Amazingly enough, finite results can be recovered from such singular
potentials.  This will be discussed further in Ch.~\ref{ch:feynman_kac}.    

The worldline path integral for this can be computed straightforwardly, and read off from the functional
determinants.  Each determinant contributes separately to an independent path integral.  
All of the free gradient operators pass over to momentum operators, but terms like $\partial_i\log\epsr$ are understood
as functions of position.  

We also assume that the functional determinant of a matrix operator does not provide any problems.  This is a large assumption,
since extra terms can appear in such matrix functional determinants in a regularization dependent manner.
Even greater care is required in treating matrix functional determinants of matrix differential operators.
While $\det(AB)=\det(A)\det(B)$ for finite matrices, for infinite matrices this is not strictly true. 
Instead, a regularization dependent factor can arise, known as the ``multiplicative anomaly''~\cite{McKenzieSmith1998}.
As discussed by McKenzie-Smith and Parker, this multiplicative anomaly is essential to ensure agreement between 
formal path integral calculations and more straightforward canonical methods.  
This is important for $\zeta$-function regularization of functional determinants, which is closely allied with the worldline method.

\begin{align}
  \cF -\cF\sup0 &= -\frac{\kB T}{2}\int_0^\infty\frac{d\cT}{\cT}\tr\bigg\{
  \big[\exp(-M_{ij}\cT)-3\exp(-M\sup0\cT)\big]\nonumber\\
  &+ \big[\exp(-M_{4}\cT)-\exp(-M\sup0\cT)\big]\nonumber\\
  &-2\big[\exp(-M_g\cT) - \exp(-M\sup0\cT)\big]\bigg\}
\end{align}
where now the trace runs over both vector indices and the continuous degrees of freedom.
The operators for the vector potential, scalar potential, gauge-fixing, and vacuum operators
are respectively given by
\begin{subequations}
\begin{align}
  M_{ij}&=\frac{1}{2}(\epsr(\op{\vect{x}})\op{p}_4^2+\op{\vect{p}}^2)\delta_{ij}
  +i(v_i(\op{x})\op{p}_j-v_j(\op{x})\op{p}_i) +V^{(A)}_{ij}(\op{x})\\
  M_4 &=\frac{1}{2}(\epsr(\op{\vect{x}})\op{p}_4^2+\op{\vect{p}}^2) + V_4(\op{x})\\
  M_g &=\frac{1}{2}(\epsr(\op{\vect{x}})\op{p}_4^2+\op{\vect{p}}^2)-\frac{i}{2}(\nabla\log\epsr)\cdot\op{\vect{p}}\\
  M\sup0 &=\frac{1}{2}(\op{p}_4^2+\op{\vect{p}}^2),
\end{align}
\end{subequations}
where the potentials $V^{(A)}_{ij}$ and $V_4$ were specified in Eq.~(\ref{eq:potentials})
First, it is not clear that the two physical degrees of freedom emerge from that path integral 
in a general dielectric.  
As written, there are three interacting vector degrees of freedom, a scalar, and a subtraction from
the gauge-fixing.  Somehow a $3\times 3$ matrix path integral, and two scalar integrals must conspire
to give two physical integrals.  
Investigations by Bordag\etal found that the ghost (gauge-fixing) degrees of freedom
did not cancel off the longitudinal and scalar degrees of freedom~\cite{Bordag1998}.  
Later work examining the spherical problem used the dual potentials and found better results that 
more closely correspond to the scalar polarizations we will develop~\cite{Bordag1999}.
Even so, those calculations still focused on the divergence structure of the theory and only found partial
agreement in the perturbative limit of weak dielectrics.  

It may be possible this complicated set of path integrals conspires to  yield the correct answer.
Instead of pursuing the matrix path integral further, we have developed an 
alternative method explicitly focusing on the two physical degrees of freedom in a simple geometry.\footnote{
The original impetus for this work was to find a scalar model that mimiced the vector wave equations electrodynamics
and see if I could get \emph{anything} to yield known results.  This was motivated by months of repeated
failures to make sense of the matrix path integral.}  

\section{Scalar Decomposition for Planar Geometries}

The EM field can be split into two non-interacting polarizations for media that only vary in one Cartesian dimension in one dimension.
These are the transverse-electric (TE) and transverse-magnetic (TM) polarizations.  In the TE polarization,
the electric field is perpendicular to the plane of incidence, while in the TM polarization the magnetic field
is perpendicular to the plane of incidence.
In the each case a scalar field theory can be developed.  For the TE polarization the electric
field behaves as a scalar throughout the problem: while its magnitude may vary, its direction does not.
The same is true for the magnetic field in the TM polarization.  
In this case, the two fields will turn out to mirror each other under a duality transformation exchanging
electric and magnetic properties of both fields and matter.  
The following work is expanded from the presentation in Ref.~\ref{Mackrory2016}.

Consider a medium which varies in only one Cartesian direction $z$.
The material properties $\epsr(z)$,$\mur(z)$ also only vary in this direction, which implies 
that the fields have the same dependence.  
In this case the action for the vector electromagnetic can be split into two non-interacting scalar fields.

From Maxwell's equations the electric and magnetic fields can be split into two sets: $(E_y, B_x, B_z)$
and $(B_y,E_x,E_z)$.

Recall that the classical action is given by 
\begin{equation}
  S = \frac{1}{2}\int d^3r\, \big(\vect{E}\cdot\vect{D} - \vect{B}\cdot\vect{H}\big). 
\end{equation}

\subsection{TE Partition Function}

The action for the TE scalar is 
\begin{equation}
  S\subTE = \int_0^T dt\, \bigg( \epsr(\vect{r})\partial_t\phi^2 - \frac{1}{\mur}|\nabla\phi|^2\bigg),
\end{equation}
where $\vect{E}= \partial_t\phi\hat{y}$.  The partition can be found via the same procedure 
we used for the Dirichlet scalar, and full four-potential.  However, we will just skip to the final
result in terms of the partition function with the Euclidean action.
The partition function in terms of the scalar $\phi:=\phi(\vect{r},\tau)$ is 
\begin{equation}
  Z\subTE = \int D\phi\, \exp\left[-\frac{1}{2}\int d^3r \int_0^{\beta\hbar c}d\tau
    \bigg(\epsr(\vect{r})(\partial_\tau\phi)^2 + \frac{1}{\mur(\vect{r})}|\nabla\phi|^2\bigg)\right].
\end{equation}
The field $\phi$ can be rescaled as $\tilde{\phi}:=\sqrt{\mur}\phi$ for the same reasons to the matrix path integral.  
The scaled field yields a Gaussian probability density in the worldline, 
and sidesteps any possible issues related to quantizing a field on a curved manifold.
The path integral can be rewritten in terms of these new variables, and after an integration by parts is written
\begin{equation}
  Z\subTE = \int D\phi\, \exp\left[-\frac{1}{2}\int d^3r \int_0^{\beta\hbar c}d\tau
    \,\phi\bigg(-\epsr(\vect{r})\mur(\vect{r})\partial^2_\tau 
    - \sqrt{\mur}\nabla\cdot\frac{1}{\mur(\vect{r})}\nabla\sqrt{\mur}\bigg)\phi\right].
\end{equation}
The gradients can be expanded out in the same fashion as Eq.~(\ref{eq:TM_potential_derivatives}), which
yields an additional potential, 
\begin{equation}
  V\subTE(z) := \frac{1}{2}\big[(\partial_z\log\sqrt{\mur})^2-\partial_z^2\log\sqrt{\mur}\big].
\end{equation}
The Gaussian integral over $\phi$ can be carried out immediately, with the result
\begin{equation}
  Z\subTE = \det\bigg\{-\frac{1}{2}[\epsr(z)\mur(z)\partial_\tau^2+\nabla^2]+V\subTE(z)  \bigg\}^{-1/2}.
\end{equation}

\subsection{TM Partition Function}

A similar derivation is possible for fields where $\vect{H}:=\partial_t\psi\hat{y}$.

In that case electromagnetic duality can be exploited to rewrite our results.
Maxwell's equations are invariant under the following duality transformation in the absence of sources:
$\epsr\Leftrightarrow \mu, \vect{D}\Leftrightarrow \vect{B}, \vect{E}\Leftrightarrow-\vect{H}$.
As one might expect, this field theory can be naturally formulated in terms of the dual potentials, 
subject to ``dual Coulomb gauge'', $\nabla\cdot\vect{C}=0$.

Exactly the same manipulations as the TE case can be carried out, but with $\epsr$ and $\mur$ exchanged.
The TM partition function is 
\begin{equation}
  Z\subTM = \det\bigg\{-\frac{1}{2}[\epsr(z)\mur(z)\partial_\tau^2+\nabla^2]+V\subTM(z)  \bigg\}^{-1/2},
\end{equation}
where the potential is 
\begin{equation}
  V\subTM(z) := \frac{1}{2}\big[(\partial_z\log\sqrt{\epsr})^2-\partial_z^2\log\sqrt{\epsr}\big].
\end{equation}
Note that the potential depends on the dielectric function in this case, and will play a much larger
role for most media.  
The simplicity of this derivation is one reason for working with both magnetic and dielectric media in this geometry.  
Given the rarity of magnetic media in quantum optical situations,  we will often set $\mur=1$.

\subsection{TE Polarization Worldline}

It is a straightforward matter to develop the TE worldline path-integral.  In the same fashion
as the Dirichlet scalar method in Sec.~\ref{sec:dirichlet_worldline}, one uses two formal identities to rewrite the free energy in exponential form.
The renormalized TE free energy is 
\begin{align}
  \cF\subTE-\cF\subTE\sup0 &= \frac{\kB T}{2}[\log\det \op{D}\subTE -\log \det \op{D}\sup0],
\end{align}
where the partition functions $Z\subTE$ were rewritten as the functional determinant of a differential operator. 
The differential operators are 
\begin{align}
  \op{D}\subTE&:=-\frac{1}{2}[\epsr(z)\mur(z)\partial_\tau^2+\nabla^2]+V\subTE(z) \\
  \op{D}\sup0&:=-\frac{1}{2}[\partial_\tau^2+\nabla^2].
\end{align}
The vacuum operator $\op{D}\sup0$ is the same for both polarization and is determined by setting $\epsr=\mur=1$ everywhere.  
The free energy can be written using the $\log-\det$ goes to $\tr-\log$ rule~(\ref{eq:log-det}),
and the integral representation of the logarithm~(\ref{eq:integral_log}), with the result
\begin{align}
    \cF\subTE-\cF\subTE\sup0 &= \frac{\kB T}{2} \tr(\log \op{D}\subTE -\log \op{D})\\
    &= -\frac{\kB T}{2} \int_0^\infty \frac{d\cT}{\cT}\tr\big[ \exp(-\op{D}\subTE\cT) -\exp(-\op{D}\sup0\cT)\big].
\end{align}
For simplicity, we will suppress the renormalization while developing the path integral.  The renormalization 
is easily recovered by setting $\epsr=\mur=1$ everywhere, and subtracting the result.

The worldline path integrals can be developed in the usual fashion, where differential operators 
pass over to momentum operators on the auxiliary Hilbert space.  There are no problems with 
operator ordering or commutation since $\epsr(z)\mur(z)\partial_4^2$ is the only case of joint position and momentum operators.
After converting the operators, the TE partition function is
\begin{align}
    \cF\subTE &= \frac{\kB T}{2}\int\frac{d\cT}{\cT}\int d\vect{x}_0d\tau_0
    \langle \vect{x}_0,\tau_0|e^{-\epsr(\op{z})\mur(\op{z})\partial_\tau^2+\op{\vect{p}}^2]\cT/2 - V\subTE(\op{z})\cT}
    |\vect{x}_0,\tau_0\rangle.
\end{align}
Note that although the potential only varies in one dimension, it is still necessary to evaluate the trace and path integrals
over all of the dimensions.  The path integral can be developed in the usual fashion.  After splitting the operator 
into the product of many terms and inserting the momentum identities we have
\begin{align}
    \cF\subTE &= -\frac{\kB T}{2}\int_0^\infty\frac{d\cT}{\cT}\int d\vect{x}_Nd\tau_N 
    \int \prod_{k=0}^{N-1}\frac{d\vect{x}_kd\tau_kd\vect{p}_kdp_{\tau,k}}{(2\pi)^D}
    \delta(\vect{x}_N-\vect{x}_0)\delta(\tau_N-\tau_0)\nonumber\\
    &\times\bigg[\prod_{j=0}^{N-1}e^{-\epsr(z_j)\mur(z_j)p_{\tau,j}^2\Delta\cT/2 +ip_{\tau_j}(\tau_{j+1}-\tau_j)}
     e^{-\vect{p}_j^2\Delta \cT/2 +i\vect{p}_j\cdot(\vect{x}_{j+1}-\vect{x}_j)- V\subTE(z_j)\Delta\cT}
    \bigg],
\end{align}
where $\Delta\cT:=\cT/N$, and the $\delta$-functions ensure path-closure. 
The Gaussian momentum integrals can be evaluated immediately, with the result that 
\begin{align}
    \cF\subTE &= -\frac{\kB T}{2}\int_0^\infty\frac{d\cT}{\cT}\int d\vect{x}_Nd\tau_N 
    \int \prod_{k=0}^{N-1}d\vect{x}_kd\tau_k
    \delta(\vect{x}_N-\vect{x}_0)\delta(\tau_N-\tau_0)\nonumber\\
    &\times\bigg[\prod_{j=0}^{N-1}\frac{1}{\sqrt{2\pi\epsr(z_j)\mur(z_j)\Delta\cT}}
    \exp\left(-\frac{(\tau_{j+1}-\tau_j)^2}{2\epsr(z_j)\mur(z_j)\Delta\cT}\right)\nonumber\\
    &\hspace{1cm}\times\frac{1}{(2\pi\Delta\cT)^{(D-1)/2}}
    \exp\left(-\frac{(\vect{x}_{j+1}-\vect{x}_j)^2}{2\Delta\cT} - V\subTE(z_j)\Delta\cT\right)
    \bigg].
\end{align}

This can be further simplified by carrying out the Gaussian integrals in $\tau$, since those 
terms carry the only $\tau$-dependence.  We will need the following Gaussian integral
\begin{align}
  \int_{-\infty}^\infty dy\, \frac{e^{-(x-y)^2/(2\sigma_1^2)}}{\sqrt{2\pi\sigma_1^2}}\frac{e^{-(y-z)^2/(2\sigma_2^2)}}{\sqrt{2\pi\sigma_2^2}}
      = \frac{1}{\sqrt{2\pi(\sigma_1^2+\sigma_2^2)}}e^{-(x-z)^2/[2(\sigma_1^2+\sigma_2^2)]}.
\end{align}
The integral shows the fact after convolving two Gaussians together, the variance of the resulting Gaussian
is the sum of the initial Gaussians.  This is useful since the Gaussian integrals have exactly this structure.
So after carrying out all of integrals over $\tau_1,\tau_2,\ldots,\tau_{N-1}$, the 
result is
\begin{align}
  &\int \prod_{j=1}^{N-1}d\tau_k \prod_{j=0}^{N}\frac{1}{\sqrt{2\pi\epsr(z_j)\mur(z_j)\Delta\cT}}
  \exp\left(-\frac{(\tau_{j+1}-\tau_j)^2}{2\epsr(z_j)\mur(z_j)\Delta\cT}\right)\nonumber\\
  &=\frac{1}{\sqrt{2\pi\langle \epsr(z)\mur(z)\rangle\cT}}
  \exp\left(-\frac{(\tau_{N}-\tau_0)^2}{2\langle\epsr(z)\mur(z)\rangle\cT}\right),\label{eq:tau-integrals}
\end{align}
where 
\begin{equation}
  \langle\epsr(z)\mur(z)\rangle = \frac{1}{N}\sum_{j=0}^{N-1} \epsr(z_j)\mur(z_j) 
  = \frac{1}{\cT}\int_0^\cT dt\, \epsr[z(t)]\mur[z(t)].
\end{equation}
We will use the single angle-brackets to denote the average of a quantity around a particular path.  
After carrying out the $\tau$-integrals, and enforcing $\tau_N=\tau_0$, the path integral is 
\begin{align}
    \cF\subTE &= -\frac{\kB T}{2}\int_0^\infty\frac{d\cT}{\cT}\int d\vect{x}_N\int d\tau_0
    \int \prod_{k=0}^{N-1}d\vect{x}_k
    \delta(\vect{x}_N-\vect{x}_0)\frac{1}{\sqrt{2\pi\langle \epsr(z)\mur(z)\rangle\cT}}\nonumber\\
    &\times\bigg[\prod_{j=0}^{N-1}\frac{1}{(2\pi\Delta\cT)^{(D-1)/2}}
    \exp\left(-\frac{(\vect{x}_{j+1}-\vect{x}_j)^2}{2\Delta\cT} - V\subTE(z_j)\Delta\cT\right)
    \bigg].
\end{align}
We want to use the spatial Gaussians as the probability distribution for paths, where $\vect{x}_0$ is the 
starting (and finishing) point.  
The same reasoning as Eq.~(\ref{eq:tau-integral}) can be used to find the normalization for the Gaussian probability density,
which is defined as
\begin{align}
  P(\vect{x}_1,\ldots,\vect{x}_N):=&\cN\int \prod_{j=0}^{N}\frac{1}{(2\pi\Delta\cT)^{(D-1)/2}}
  \exp\bigg(-\frac{(\vect{x}_{j+1}-\vect{x}_j)^2}{2\Delta\cT}\bigg).
\end{align}
The normalization constant $\cN$ is determined by requiring that the probability density is normalized to one,
\begin{align}
1&=\int\prod_{j=1}^{N-1} d\vect{x}_k P
\implies \cN=\left[\frac{1}{\sqrt{2\pi\cT}}\exp\left(-\frac{(\vect{x}_{N}-\vect{x}_0)^2}{2\cT}\right)\right]^{-1}.
\end{align}

The path integral can be written as an ensemble average over closed Brownian bridges,
\begin{align}
    \cF\subTE-\cF\sup0 &= -\frac{\hbar c}{2}\int_0^\infty\frac{d\cT}{(2\pi\cT)^{D/2}\cT}\int d\vect{x}_0
    \biggdlangle
    \frac{1}{\sqrt{\langle \epsr(z)\mur(z)\rangle}} e^{-\langle V\subTE(z)\rangle\cT}-1
    \biggdrangle_{\vect{x}(t)},\label{eq:TE_worldline}
\end{align}
where we also used $\int d\tau_0 = \beta\hbar c$ to write the free energy as the zero-temperature energy. 
For completeness we note that the corresponding TM worldline method is derived in exactly the same way, so we quote
the result
\begin{align}
    \cF\subTM-\cF\sup0 &= -\frac{\hbar c}{2}\int_0^\infty\frac{d\cT}{(2\pi\cT)^{D/2}\cT}\int d\vect{x}_0
    \biggdlangle
    \frac{1}{\sqrt{\langle \epsr(z)\mur(z)\rangle}} e^{-\langle V\subTM(z)\rangle\cT}-1
    \biggdrangle_{\vect{x}(t)}.\label{eq:TM_worldline}
\end{align}
The main difference between the two path integrals is that $V\subTE$ depends on the magnetic response, while $V\subTM$ 
depends on the dielectric response.  As a result the TM potential is much more important for typical
materials.  In order to deal with this singular potential, we will work hard to handle this analytically and numerically.  

Let us contrast the TE worldline (\ref{eq:TE_worldline}) with the Dirichlet worldline path integral (\ref{eq:scalar_worldline}). 

First, there is a factor $\epsr\mur$ (corresponding to the square of the refractive index) 
modifying the thermal direction and an additional potential deriving from the discontinuities of the media.
The potentials will naturally enforce boundary conditions at surfaces in certain limits, far more naturally than the 

Second, the TE path integral is adapted to a planar geometry, whereas the Dirichlet path integral is geometry
independent.  We can test this path integral in this geometry to verify that
known electromagnetic results can be recovered from this worldline formalism.  In addition we can develop 
techniques that will be useful in a general geometry, and evaluate the path integrals in a manner that should straightforwardly
generalize.  We will see that this path integral can recover the Dirichlet results in the strong-coupling
$\epsr\rightarrow\infty$ limit.  So despite being adapted to a particular geometry
the TE path integral may suggest ways to develop a better uncontrolled approximation to the full path integral.

We should note that this derivation assumed zero temperature throughout, or the $\beta\rightarrow\infty$ limit. 
An alternative, more careful approach does not even develop the path integral in $\tau$, since the only 
depedence in that direction is carried by $\op{p}_\tau$.   It is essential to develop the spatial
path integral, since the prefactors of this term do not commute with the spatial momentum operators.  
The better derivation works with the Matsubara frequencies.  In the above working replace $\op{p}_\tau$ with $s_n$,
where each separate Matsubara frequency contributes separately.  At the end of the calculation the zero-temperature
limit can be taken to convert the sum over Matsubara frequencies into an integral.  The integral over the frequency
yields the answer quoted above.  

\section{Nonzero temperature Worldline Path Integrals}

Let us change to using $\tau = \beta \hbar c$ as our temperature coordinate.  Then   
\begin{equation}
  Z_{TE} = \int D\phi \exp\left[ -\frac{\epsilon_0 c^2 }{2 \hbar c}\int_0^\beta d\tau'\int d^3\vect{r}\, 
    \left( \epsr(\vect{r})(\partial_{\tau}\phi)^2 + \frac{1}{\mur(\vect{r})}|\nabla\phi|^2\right)\right].
\end{equation}

Since the path integral is periodic for $\tau\in[0,\beta\hbar c]$, the fields can be expanded 
in a Fourier series,
\begin{equation}
  \phi(\tau,\vect{r}) = \sum_{n=-\infty}^{\infty}e^{is_n \tau/c} \phi_n(\vect{r}).
\end{equation}
Here the Matsubara frequencies are defined as $s_n:=2\pi n/(\beta\hbar)$, and
the $\phi_n$ are complex fields.  We will also need to use the orthogonality relation,
\begin{equation}
\int_0^{\beta \hbar c}d\tau e^{i\frac{(s_n+s_m)}{c}\tau} = \beta\hbar c \delta_{n,-m},
\end{equation}
where $\phi_n^* = \phi_{-n}$ since $\phi^*(\beta, \vect{r}) = \phi(\beta, \vect{r})$.  

% \begin{shaded}
% \comment{See Dec 2012 notes for how to handle the variable counting from doubling the number of variables}
% I'm just trying to figure out the factors of 2 here - just think of the transform to Matsubara 
% frequencies as a ordinary change of variables.
%   In December I had completely reduced the problem to a discrete problem in $\beta$ as well.
%   Say I have $N_\beta$ initial time-steps.
%   I have $N_\beta$ real variables.
%   If I introduce a Fourier series, then I now have $N-2$ complex variables for $0<n<N_\beta/2$, and 2 real variables at $n=0, N_\beta/2$.
%   Furthermore we know that $\phi_n^* = \phi_{-n}$.
%   So from the Gaussian structure of the integrals over $\phi_n$, each of these $(N-2)$ integrals over $\phi_n$ is equal.
%   When I carry out the integrals I have 
% \begin{equation}
% \prod_{n=-N_\beta/2}^{N_\beta/2-1}\int D\phi_n e^{-A_n|\phi_n|^2} 
% = C\left( \frac{1}{\sqrt{A_0}}\frac{1}{\sqrt{A_{N_\beta/2}}}\prod_{n>0}\frac{1}{A_n}\right),
% \end{equation}
% where I have used 
% \begin{equation}
% \int D\phi_nD\phi_n^* e^{-A_n|\phi_n|^2} = \int D\phi_r D\phi_ie^{-A_n(\phi_r^2+\phi_n^2)} = \frac{1}{A_n}, 
% \end{equation}
% where $\phi_n = \phi_r + i \phi_i$.
%   We then consider the limit where $N_\beta\rightarrow \infty$.  
% \end{shaded}

We assume that the appropriate frequency dependent path integral is 
\begin{equation}
Z_{TE} = \prod_{n=-\infty}^{\infty} \int D\phi_n\exp\left[ -\frac{\beta \epsilon_0 c^2 }{2}
  \int d^3r\, \phi_n^*(\vect{r})\left(\epsr(\vect{r},s_n)\frac{s_n^2}{c^2} 
    -\nabla\cdot\frac{1}{\mur(\vect{r},s_n)}\nabla\right)\phi_n(\vect{r})\right] .
\end{equation}

%Now let's \comment{assume} we just handle dispersion by taking $\epsilon(\vect{r})\rightarrow \epsilon(is_n,\vect{r})$.
The same field rescalings can be carried out as for the frequency independent case.  
The Gaussian integrals for each $\phi_n$ can be carried out, so that the free energy can be written
% This idea is following Rahi's derivation where $\epsilon$ is treated as an effective action 
% where the effect of the electron field has been intregrated out.  
as
\begin{equation}
-\kB T\log Z_{TE} = -{\sum_{n=0}^\infty}'\log\det\left[
\epsr(is_n,\vect{\vect{r}})\mur(is_n,\vect{\vect{r}})\frac{s_n^2}{2c^2} -\frac{1}{2}\nabla^2+V\subTE^{(n)}\right],
\end{equation}
where prime on the sum indicates that the $n=0$ is multiplied by a half and
\begin{equation}
  V^{(n)}\subTE(z) := \frac{1}{2}\big[\big(\partial_z\log\sqrt{\mur(z,is_n)}\big)^2-\partial_z^2\log\sqrt{\mur(z,is_n)}\big].
\end{equation}
The free energy is renormalized by subtracting off the vacuum energy where $\epsr=\mur=1$ and $V\subTE^{(n)}$ is zero. 
% \begin{equation}
% \log Z_{TE} -\log Z_0= -{\sum_{n=0}^\infty}'\left\{\log\det\left[ 
% \frac{1}{2}\left(\epsilon(is_n,\vect{\vect{r}})\frac{s_n^2}{c^2} -\nabla^2\right)\right] 
% - \log\det\left[ \frac{1}{2}\left(\frac{s_n^2}{c^2} -\nabla^2\right)\right]\right\}
% \end{equation}
Note that the zero frequency contribution vanishes if $\lim_{\omega\rightarrow 0}\omega^2\epsr(\omega)=0$, 
and $\mur=1$.  This is related to the dispute over the role of the zero frequency pole in the dielectric
response of a metal.  

% for $n=0$ the Matsubara frequency $s_n=0$, so we have 
% \begin{align}
%   \log\det\left[ \frac{1}{2}\left(\epsilon(0,\vect{\vect{r}})\frac{s_0^2}{c^2} -\nabla^2\right)\right]
%  - \log\det\left[ \frac{1}{2}\left(\frac{s_0^2}{c^2} -\nabla^2\right)\right] = 0.
% \end{align}
% This assumes that $\epsilon(\omega)$ has at most a simple pole at zero frequency, 
% such that $\lim_{\omega\rightarrow 0}\omega^2\epsilon(\omega)=0.$    

The nonzero temperature TE worldline path integral can be developed as before.  In this case only
a $(D-1)$-dimensional Hilbert space is needed to evaluate the trace, since the thermal dimension is 
handled with the Matsubara frequencies.
\begin{align}
\cF-\cF_0 %& = -k_BT \log \frac{Z_{TE}}{Z_0} \\
% & = k_B T \frac{1}{2}{\sum_{n}}'\tr\left\{ \log\left[ \frac{1}{2}
%     \left(\epsilon(is_n,\vect{x})\frac{s_n^2}{c^2} -\nabla^2\right)\right]
% -\log\left[ \frac{1}{2}\left(\frac{s_n^2}{c^2} -\nabla^2\right)\right]\right\}\\
=&-\frac{k_BT}{2}{\sum_{n=0}^\infty}'\int_0^\infty \frac{d\cT}{\cT(2\pi \cT)^{(D-1)/2}}\int d^{D-1}x_0\,\nonumber\\
&\times\dlangle e^{-s_n^2\cT /(2c^2)} -  e^{-s_n^2\langle\epsr(\vect{x},is_n)\mur(\vect{x},is_n)\rangle\cT /(2c^2)}
e^{-\cT\langle V\subTE^{(n)}(\vect{x})\rangle}\drangle,
\label{eq:TEworldline_partition_function}
\end{align}
where the paths are $D-1$ dimensional spatial paths.  
% where we introduced the path integral.
%   In this case the operator $ e^{T\nabla^2}$ only needs a 3-dimensional Hilbert space.
%   So we also only use the normalization for 3D.
This scaling with $\cT$ also reflects the different scaling behaviours in the near-field, 
thermal and far-field regions, as these will each have different approximations to the Matsubara sum.  

The zero-temperature limit can be recovered by converting the Matsubara sum into a frequency integral.
In the limit $T\rightarrow 0$, the spacing between frequencies $\Delta s = (2\pi n)/\beta \hbar\rightarrow 0$.
If we treat the material responses as being frequency independent, then the integral over frequency
is Gaussian, and the zero temperature worldline (\ref{eq:TE_worldline}) is recovered.

The nonzero temperature path integral is also a more natural fit for the analytical techniques we will
employ in the next chapter.  


% \section{Quantization with Harmonic Medium and Linear Response}

% In this section we will attempt to carry out the full quantization procedure for a harmonic
% medium.  We will start from a gauge-invariant Lagrangian for the electromagnetic field coupled
% to a medium. 
% We will derive the Hamiltonian, and then compute the partition function.
%  We will then gauge-fix, and integrate out the harmonic medium.  This is essentially
% based on the approach of deriving the dielectric via linear response theory advocated in Rosa~\etal\cite{Rosa2008}.
% We will integrate out the matter-fields, and treat the interaction out to second order in the interaction.  
% We will then carry out the remaining integral over the fields.  

% This method should be well-defined perturbation theory, and follow the usual physical reasoning.  This
% should avoid any of the strange features of trying to quantize the field while it is already
% interacting with an effective medium.  

% The combined field-matter Lagrangian for the EM field interacting with a charged scalar field is
% \begin{align}
%   L =& \int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_t\vect{A})^2
%   - \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
% &+\bigg(\partial_t+i\frac{e}{c}A_0\bigg)\phi^*\bigg(\partial_t-i\frac{e}{c}A_0\bigg)\phi
% - \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
% -\phi^*(u(x)+m^2)\phi\bigg],
% \end{align}
% where there is a potential $u(x)$ binding the charged scalar to exist only in certain regions.  We
% will take $u(x)=0$ inside the bodies, and $u(x)\rightarrow\infty$ outside the bodies.  
% The action is invariant under the combined gauge transformations,
% \begin{align}
%  A_0&\rightarrow A_0-\partial_t\alpha\\
% \vect{A} & \rightarrow \vect{A}+\nabla\alpha\\
% \phi &\rightarrow e^{-i\frac{e}{c}\alpha}\phi.
% \end{align}

% The canonical momenta are found to be
% \begin{align}
%   \pi_0 &:= \frac{\delta L}{\delta (\partial_t A_0)} = 0\\
%   \vect{\Pi} & := \frac{\delta L}{\delta(\partial_t\vect{A})} = \epsilon_0(\nabla A_0+\partial_t\vect{A})\\
%   \vect{\pi} & := \frac{\delta L}{\delta(\partial_t\phi)} = \bigg(\partial_t+i\frac{e}{c}A_0\bigg)\phi^*.
% \end{align}
% As noted before, the vanishing of $\pi_0$ is a constraint which must be maintained by the dynamics.
% Preserving this constraint will require that $\partial_t\vect{\Pi}=\nabla\cdot\vect{\Pi}=0$.
% We will employ the Gupta-Bleuler quantization, which restricts the allowed states. 

% The full Hamiltonian is 
% \begin{align}
%   H &:= \int d\vect{x}(\pi_0 \partial_t A_0+\vect{\Pi}\cdot\partial_t\vect{A}+\pi\partial_t\phi 
%   +\pi^*\partial_t\phi^*) - L\\
% %   &:= \int d\vect{x}\bigg[\vect{\Pi}\cdot\frac{(\Pi-\nabla A_0)}{\epsilon_0}
% %   +\pi(\pi^*+i\frac{e}{c}A_0\phi^*) +\pi^*(\pi-i\frac{e}{c}A_0\phi^) \\
% %  &-\frac{\vect{\Pi}^2}{2\epsilon_0} + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
% % &-\frac{\pi^*\pi}{2}+ \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
% % +\phi^*(u(x)+m^2)\phi\\
%   &:= \int d\vect{x}\bigg[\frac{\vect{\Pi}^2}{2\epsilon_0}+\frac{1}{2\mu_0}(\nabla\times\vect{A})^2+\pi^*\pi 
%  +\phi^*(-\nabla^2 + u(x)+m^2)\phi\nonumber\\
%  &\hspace{1cm}  +i\frac{e}{c}A_0(\pi \phi^*-\pi^*\phi) 
%    +i\frac{e}{c}\vect{A}\cdot \big(\phi\nabla\phi^*-\phi^*\nabla\phi\big)+\frac{e^2}{c^2}|\vect{A}|^2\phi^*\phi
% +A_0\frac{\nabla\cdot\vect{\Pi}}{\epsilon_0}
%  \bigg]
% \end{align}

% Given the Hamiltonian, the partition function can be readily computed, given the Gaussian
% nature of the integrals.  The long-and-short of this procedure should be that we will find 
% $Z\sim\int D()e^{-S_E}.$
% \begin{align}
%   Z &= \tr[e^{-\beta \op{H}}]\\
%   &= \int d^2\phi d\vect{A} dA_0 \langle A_0,\vect{A}| e^{-\beta \op{H}}|A_0,\vect{A}\rangle\\
%   &= \int D\phi^*D\phi D\vect{A} DA_0 D\pi^*D\pi D\vect{\Pi}D\Pi_0\delta(\pi_0)\delta(\nabla\cdot\Pi)
%   e^{-\Delta \beta H_n +\frac{i}{\hbar}(\vect{\Pi}\cdot\partial_\beta \vect{A}+\pi^*\partial_\beta\phi )}
% \end{align}
% \comment{should probably split $\phi = \phi_1+i\phi_2$ integrating over complex fields requires some
% care with the book-keeping.  Then find $\pi_1,\pi_2$.  Can use $\langle \phi_1|\pi_1\rangle = e^{i\phi_1\pi_1/\hbar}$.
% }

% End result of careful integration over two independent real fields for matter, we can just skip to 
% \begin{align}
%   Z = \int D\phi^*D\phi D\vect{A}DA_0 e^{-S_E},
% \end{align}
% where
% \begin{align}
%   S_E =& \int_0^{\hbar\beta} d\tau\int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_\tau\vect{A})^2
%   + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
%   &+\bigg(\partial_\tau+i\frac{e}{c}A_0\bigg)\phi^*\bigg(\partial_\tau-i\frac{e}{c}A_0\bigg)\phi
%   + \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
%   +\phi^*(u(x)+m^2)\phi\bigg],
% \end{align}
% and $\tau=\hbar \beta$, and we also scaled $A_0\rightarrow \hbar^{-1} A_0$.  

% Now expand the matter part out to quadratic order in the coupling.
% \begin{align}
%   S_E =& \int_0^{\hbar\beta} d\tau\int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_\tau\vect{A})^2
%   + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2
%   +\phi^*\big(-\partial_\tau^2-\nabla^2+u(x)+m^2\big)\phi\nonumber\\
%   &+ i\frac{e}{c}A^\mu(\phi^*\partial_\mu\phi -\phi\partial_\mu\phi^*)
%   +\frac{e^2}{c^2}A^\mu A_\mu\phi^*\phi-i\frac{e}{c}\partial_\mu A^\mu\phi^*\phi\bigg] 
% \end{align}
% where we are using the Euclidean inner product for 4-vectors.  


% \subsection{Rahi approach}
% \begin{enumerate}
%   \item Expand exponential to second order in $e$.
%     \begin{equation}
%     e^{-\int d^4x A_\mu j^\mu} \approx (1 - \int d^4x A_\mu(x)j^\mu(x) +\frac{1}{2}\int d^4x A_\mu(x) A_\nu(y)
%     j^\mu(x)j^\nu(y))
%   \end{equation}
%   \item Evaluate Gaussian integrals,
%     \begin{equation}
%       \int D\phi D\phi^* \phi^*(x)\phi(x) e^{-\int d^4x \phi^*(x)G^{-1}\phi(x)} = G(x)
%     \end{equation}
%   \item Simplify, Re-exponentiate.
%     Some people use Kubo formula.
%     By definition for linear response, with Ohm's law 
%     \begin{equation}
%       \vect{J} = \sigma \vect{E},
%     \end{equation}
%     so $\sigma = \epsilon-1$.  
%     Kubo formula for conductivity in linear response is 
%     $\sigma^{\mu\nu}(\omega) = \int dt \langle[ j^\mu(t),j^\nu(t')] e^{-i\omega t}.$
%     Quite general relationship.  $\sigma$ is susceptibility, $[j,j]$ is Green function response.  
    
%     Hopefully can do this calculation for general 


% \end{enumerate}





%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "thesis_master"
%%% End: 
