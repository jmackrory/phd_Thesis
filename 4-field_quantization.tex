\chapter{Electromagnetic Field Quantization}

This chapter attempts to extend the vacuum derivation to also account for a spatially dependent dielectric function.
  However, we will not treat the frequency dependence.
  We start from the Lagrangian for the EM field and verify it gives the correct equations of motion.
  We then go over to the Hamiltonian formalism, by taking the Poisson brackets over to commutation relations.
  We enforce the constraints generated by the Lagrangian/Hamiltonian by restricting the states we allow in the theory.
  This allows us to write down the partition function and turn it into a path integral. 

\section{Effective Dielectric Hamiltonian Quantization}

\section{Maxwell's Equations and potentials}

Maxwell's equations in a dielectric, non magnetic medium, without sources  are
\begin{align}
\nabla \cdot \vect{D} &= 0\\
\nabla \cdot \vect{B} &= 0\\
\nabla \times \vect{E} &= -\partial_t\vect{B}\\
\nabla\times\vect{H} &= \mu_0\partial_t\vect{D}.
\end{align}

Here we will ignore the frequency dependence and dispersion.
  We are implicitly assuming a monochromatic field.
  Later, we will extend this work to handle frequency dependence in the dielectric.
  Dealing with dispersion also forces us to deal with dissipation.
  Quantization with a dielectric medium has been done by Huttner and Barnett~\cite{Huttner1992}, 
and in the Casimir context by Rosa~\textit{et.~al.}~\cite{Rosa2010}.  

For a linear medium we can write 
\begin{equation}
\vect{P}(\vect x) = \epsilon_0\chi(\vect x)\vect{E}(\vect x),
\end{equation}
where $\vect{P}$ is the polarization and $\chi$ is the linear response function of the medium.
  The displacement can be rewritten
\begin{equation}
\vect{D}(\vect x) = \epsilon_0\vect{E}+\vect{P} = 
\epsilon_0(1+\chi(\vect x))\vect{E}(\vect x)= \epsilon_0\epsvx\vect{E}(\vect x).
\end{equation}
We can define the fields in terms of the potentials:
\begin{subequations}
\begin{align}
\vect{B} &= \nabla\times\vect A\\
\vect{E} &= -\nabla\phi -\partial_t\vect A,
\end{align}
\end{subequations}
which automatically satisfies two of Maxwell's equations.  
Note that the fields are unchanged if we make the following gauge transformation $(\phi,\vect A)\rightarrow(\phi',\vect A')$.  
\begin{subequations}
\begin{align}
\vect A' &= \vect A +\nabla\alpha\\
\phi' & = \phi - \partial_t\alpha
\end{align}
\end{subequations}

The remaining two Maxwell equations are then given by
\begin{align}
\nabla\cdot\left[ \epsilon_0\epsvx\left(-\nabla\phi-\partial_t\vect A\right)\right] &= 0\\
\nabla\times\nabla\times\vect A +\mu_0\epsilon_0\epsvx\partial_t\left(\nabla\phi+\partial_t\vect A\right)&=0.
\end{align}

\section{Classical Lagrangian Formulation}

Now since we want to go over to quantum mechanics we must start from a Lagrangian formalism.
  We will choose a Lagrangian, following other workers \cite{Huttner1992, Glauber1991}, and show that it retrieves Maxwell's equations.  
\begin{align}
L &= \frac{1}{2}\int d^3x\, \vect{E}\cdot\vect{D} - \vect{B}\cdot\vect{H} \\
& = \frac{\epsilon_0}{2}\int\! d^3x\, \epsvx(\nabla\phi+\partial_t\vect A)^2 - c^2(\nabla\times\vect A)^2.
\end{align}

The momenta conjugate to the coordinates $A^\mu = (\phi,\vect A)$ are
\begin{align}
\Pi_0 & = \frac{\delta L}{\delta (\partial_t\phi)} = 0 \label{eq:Pi0}\\
\vect{\Pi} & = \frac{\delta L}{\delta (\partial_t\vect A)} = \epsilon_0\epsvx(\nabla\phi+\partial_t\vect A).
\end{align}

As before, we must satisfy the constraints that $\Pi_0 = 0$.
  This will in turn provide another constraint for the Hamiltonian theory.
  We will try to follow Dirac's program for dealing with constraints in quantization~\cite{Dirac1964, Dirac1966}

Ultimately we want to develop the Hamiltonian formulation where we will have to be careful
 to correctly account for the constraints.
  We are going to follow the approach suggested by Paul Dirac in refs \cite{Dirac1964, Dirac1966}, 
which is analogous to the Gupta-Bleuler formulation.
  In that method the fields have canonical commutation relations imposed upon them, 
and the gauge freedom restricts the states allowed the theory.  
Eq. (\ref{eq:Pi0}) is a constraint on the Hamiltonian and we must check for any further constraints implied by that.
  We must take all of these into account, \emph{after} we take over the classical Poisson brackets
 over to quantum commutation relations. 

If we now use the Euler-Lagrange equations of motion
\begin{equation}
\frac{d}{dt}\left(\frac{\delta L}{\delta (\partial_t A^\mu)}\right) -\frac{\delta L}{\delta A^\mu}= 0,
\end{equation}
we should recover Maxwell's equations.  First, for $A_0$ the canonical momentum vanishes so we only need to evaluate
\begin{equation}
\frac{\delta L}{\delta \phi} = -\epsilon_0\nabla\cdot\left[\epsvx(\nabla\phi+\partial_t\vect A)\right] = 0
\end{equation}
which is merely Coulomb's Law in a medium, provided we recognize $\vect{D} = -\epsilon_0\epsvx(\nabla\phi+\partial_t\vect A)$.
  For the remaining coordinates $\vect A$ we need 
\begin{align}
\frac{d}{dt}\frac{\delta L}{\delta (\partial_t\vect A)}& = \epsilon_0\partial_t\left[\epsvx(\nabla\phi+\partial_t\vect A)\right]\\
\frac{\delta L}{\delta \vect A} &= -\frac{1}{\mu_0}\nabla\times\nabla\times\vect A. 
\end{align}
The equation of motion is then 
\begin{equation}
\epsilon_0\partial_t\left[\epsvx(\nabla\phi+\partial_t\vect A)\right] + \frac{1}{\mu_0}\left(\nabla\times\nabla\times\vect A\right)  = 0,
\end{equation}
which is just the Ampere-Maxwell law.  So the Lagrangian is an acceptable starting point.  

\section{Hamiltonian}

We now proceed to the Hamiltonian formulation for the classical field.   The Hamiltonian is given by
\begin{align}
H &= \int d^3x\, \Pi_0\dot{A}_0+\vect \Pi\cdot\dot{\vect A}- \mathcal{L}\\
& = \int d^3x \, \vect \Pi\cdot\left(\frac{\vect{\Pi}}{\epsilon_0\epsvx}-\nabla\phi\right)
-\frac{\vect \Pi^2}{2\epsilon_0\epsvx} + \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2\\
& = \int d^4x  \frac{\vect \Pi^2}{2\epsilon_0\epsvx}-\vect{\Pi}\cdot\nabla\phi
 + \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2
\end{align}

\subsection{Poisson Bracket}
The Poisson bracket in 4-vector notation follows from the choice that $A^\mu = (\phi,\vect A)$.
  This implies that the momentum conjugate to $A^\mu$ is given by
\begin{equation}
\Pi_\mu = \frac{\partial \mathcal L}{\partial \dot{A}^\mu}.
\end{equation}
The Poisson bracket for normal variables, with canonical variables and momenta ${q_k,p_k}$ is defined as 
\begin{equation}
[f,g] = \sum_k \frac{\partial f}{\partial q_k}\frac{\partial g}{\partial p_k}
 -\frac{\partial f}{\partial p_k}\frac{\partial g}{\partial q_k},
\end{equation}
so we generalize this to deal with fields by replacing derivatives with functional derivatives, 
\begin{equation}
[F_\mu(\vect{x}),G_\nu(\vect{x'})] = \sum_\alpha\int d\vect{y}\bigg[
\frac{\delta F_\mu(\vect{x})}{\delta A^\alpha(\vect{y})}\frac{\delta G_\nu(\vect{x'})}{\delta \Pi_\alpha(\vect{y})}
 -\frac{\delta G_\mu(\vect{'x})}{\delta A^\alpha(\vect{y})}\frac{\delta F_\nu(\vect{x})}{\delta \Pi_\alpha(\vect{y})}\bigg],
\end{equation}
where we have used $\Pi_\mu$ is conjugate to $A^\mu$.  The Poisson bracket between the fields and momenta is
\begin{align}
[A_\mu(\vect{x}),\Pi_\nu(\vect{x'})] &= \sum_\alpha\int d\vect{y}  \bigg[
\frac{\delta A_\mu(\vect{x})}{\delta A^\alpha(\vect{y})}\frac{\delta \Pi_\nu(\vect{x'})}{\delta \Pi_\alpha(\vect{y})}\\
& = \sum_\alpha\int d\vect{y}g_{\mu \alpha}\delta^{\nu}_\alpha\delta(\vect{x'-y})\delta(\vect{x-y})\bigg] = g_{\mu \nu}\delta(\vect{x-x'}).  
\end{align}
When we go over the quantum theory, the Poisson bracket between the fields goes over to the commutator between the field operators.  


\subsection{Constraints}
Now we need to consider the constraints.
  We will use Paul Dirac's scheme for dealing with the constraints.
  We need to ensure that the constraints are obeyed at all times 
- which requires that all of the Poisson brackets with the Hamiltonian should vanish.
   We should also consider the Poisson brackets of those constraints until we have exhausted 
all of the conditions implied by the constraint.  
From Eq.~\ref{eq:Pi0}, we have $\Pi_0 = 0$.  This in turn implies that 
\begin{equation}
\partial_t\Pi_0 = [\Pi_0,H ] =-\frac{\delta H}{\delta \phi} = \nabla\cdot\vect{\Pi} = 0. 
\end{equation}
So we also have the constraint that $\nabla\cdot\vect{\Pi} = 0$.
  Coulomb's law emerges as a constraint on the fields.  

We can equally well write the Hamiltonian as 
\begin{align}
H& = \int d^4x  \frac{\vect{\Pi}^2}{2\epsilon_0\epsvx}+\phi(\nabla\cdot\vect{\Pi})
 + \frac{\epsilon_0c^2}{2}\left(\nabla\times\vect A\right)^2 + f\Pi_0 + g(\nabla\cdot\vect{\Pi})
\end{align}
where $f$ and $g$ are arbitrary functions.
  Since the constraints must be satisfied this is equivalent to adding zero.
  I don't think this means anything for us - this is just a manifestation of the gauge freedom of the electromagnetic field.  
  These constraints serve as the generators of gauge transformations.  

\section{Quantum Theory}
To pass over to the quantum theory we take the Poisson brackets over to commutation relations 
between operators and impose the constraints on the states we allow in the theory.
 In this Gupta-Bleuler formalism, we restrict the states allowed in the theory to obey the constraints,
 rather than the operators.  

The equal time commutation relations are now 
\begin{equation}
[A_\mu(\vect x,t),\Pi_\nu(\vect{x'},t)] = i\hbar g_{\mu\nu}\delta^{3}(\vect{x-x'}),
\end{equation}
and the states obey:
\begin{equation}
\hat{\Pi}_0|\Psi\rangle = 0, \quad \nabla\cdot\hat{\Pi}|\Psi\rangle = 0.
\end{equation}
When we insert identities we will use 
\begin{align}
V_\mathrm{gauge} &= \int d^3\vect A d\phi|\phi,\vect A\rangle\langle \phi,\vect A|\\
1 &= \int d^4\Pi |\vect{\Pi}\rangle\langle\vect{\Pi}|\delta(\nabla\cdot\vect{\Pi})\delta(\Pi_0) 
= \int d^3\vect{\Pi} |\vect{\Pi}\rangle\langle\vect{\Pi}|\delta(\nabla\cdot\vect{\Pi})
\end{align}
The volume shows up because we are integrating over equivalent physical states that are related by gauge transformations.
  We won't care about this, since the volume only adds a constant to the energy.
  The delta function in the momentum states ensures that we only include states that obey the constraints.
  We are ignoring any determinant that arising from changing measure, or rather assuming that it is already correctly accounted for.  

We will also use the Fourier representation of the delta function
\begin{equation}
\delta(\nabla\cdot\vect{\Pi}) = \int D\Lambda \exp\left[-\frac{i}{\hbar}\int d^3x 
  \Lambda(\vect x)\nabla\cdot\vect{\Pi}(\vect x)\right],
\end{equation}
where the factor of $\hbar$ is put there for later convenience.  

Since the fields and momenta obey canonical commutation relations, and $\hat{\Pi}_0|\Psi\rangle = 0$, we can use
\begin{equation}
\langle \phi,\vect A | \Pi_0,\vect{\Pi} \rangle = \exp\left[-\frac{i}{\hbar}\int d^3x \vect A\cdot\vect{\Pi}\right].
\end{equation}

\section{Path Integral for Partition Function}

Ultimately we want to evaluate the ground state energy, which requires that we evaluate the partition function 
\begin{equation}
Z = \mathrm{Tr}[e^{-\beta H}] = \int d\phi d\vect A \langle \phi,\vect A|\exp(-\beta H)|\phi,\vect A\rangle.
\end{equation}
This is just the path integral, after we have analytically continued to imaginary time.
  We can read this as $\beta = i\tau$.
   The path integral is given by
\begin{align}
Z & = \int d\phi d\vect A \langle \phi,\vect A|e^{-\beta \hat{H}}|\phi,\vect A\rangle \\
& = \int d\phi d\vect A \langle \phi, \vect A| \prod_{i=1}^{N}e^{-d\beta\hat{H}}|\phi,\vect A\rangle,
\end{align}
where $d\beta = \beta/N$.
  Now we insert $(N-1)$ factors of the gauge volume between each factor of $e^{-d\beta\hat{H}}$.  
\begin{equation}
Z  = \prod_{i=1}^N\int d\phi_id\vect A_i \delta(\vect A_N-\vect A_0)\delta(\phi_N-\phi_0)
\langle \phi_i,\vect A_i|e^{-d\beta\hat H}|\phi_{i-1},\vect A_{i-1}\rangle,
\end{equation}
where we have defined $A^\mu_N=A^\mu_0=A^\mu$.
  Now we note that each $A_i$ corresponds to a particular temperature range, 
so we can write $A_i = A_{\beta+d\beta}$ and $A_{i-1}=A_\beta$.  

Next we insert the identity for the momentum states between each matrix element.
  We focus our attention on a particular slice of matrix elements:
\begin{align}
&\langle \phi_{\beta+d\beta}\vect A_{\beta+d\beta}| \exp[-d\beta \hat{H}]|\phi_\beta, \vect A_\beta\rangle \\
& = \int d\Pi_0 d\vect{\Pi}_\beta\,\delta(\Pi_0)\delta(\nabla\cdot\vect{\Pi}_\beta)
\langle \phi_{\beta+d\beta},\vect A_{\beta+d\beta}|\Pi_{0,\beta} \vect{\Pi}_\beta\rangle 
\langle \Pi_{0,\beta}\vect{\Pi}_\beta|\exp[-d\beta \hat{H}]|\phi_\beta,\vect A_\beta\rangle\\
& = \int d\vect{\Pi}_\beta\,\delta(\nabla\cdot\vect{\Pi}_\beta)
\langle \vect A_{\beta+d\beta}| \vect{\Pi}_\beta\rangle
\langle \vect{\Pi}_\beta|\exp[-d\beta \hat{H}]|\vect A_\beta\rangle.
\end{align}
We then confine our attention to the spatial momenta, since the integral over $A_0$ is a constant.
Since no factors of $A_0$ show up we are also free to change variable (make a gauge transformation) at a later stage in the calculation.  

Using the Fourier representation of the delta function, we can write one of those matrix elements as 
\begin{multline}
\int\! d\vect{\Pi}_\beta \int\! D\Lambda_\beta\exp\bigg[ \int d^3x \,
-\frac{i}{\hbar}\Lambda_\beta(\nabla\cdot\vect{\Pi}_\beta) +\frac{i}{\hbar}\left(\vect A_{\beta+d\beta}
-\vect A_{\beta}\right)\cdot\vect{\Pi}_\beta  -d\beta\left( \frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsvx}
+\frac{1}{2}\epsilon_0c^2(\nabla\times \vect A_\beta)^2\right)\bigg]\\
= \int\! d\vect{\Pi}_\beta \int\!D\Lambda\exp\bigg[ -d\beta\int d^3x 
\left( \frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsvx} 
-\frac{i}{\hbar}\vect{\Pi}_\beta\cdot(\partial_\beta \vect A_\beta + \nabla\Lambda_\beta) 
+\frac{1}{2}\epsilon_0c^2(\nabla\times \vect A_\beta)^2\right)\bigg]
\end{multline}
where we have rescaled $\Lambda$ by $d\beta$ in order to factorize out the term in $d\beta$.
  We will be subtracting off the vacuum energy, so we will be sloppy over keeping track of any constant normalization factors.
  We will need to be careful over constants with position dependence, 
but overall factors of $\pi, c,\text{etc.}$ are irrelevant. 
 We have also integrated by parts on the term coming from the Fourier representation of the delta function.
  In addition we have identified 
\begin{equation}
\partial_\beta\vect A_\beta=\frac{\vect A_{\beta+d\beta}-\vect A_\beta}{d\beta}.
\end{equation}
As before we can carry out the momentum integral by completing the square.
  The result of the momentum integral is
\begin{align}
 \int\! d\vect{\Pi}_\beta \exp\left[ -d\beta\int d^3x \frac{\vect{\Pi}_\beta^2}{2\epsilon_0\epsvx} 
-\frac{i}{\hbar}\vect{\Pi}_\beta\cdot(\partial_\beta \vect A_\beta - \nabla\Lambda_\beta) \right] 
\propto   [\epsvx]^{3/2}\exp \left[ -\frac{\epsilon_0d\beta}{2\hbar^2}\int d^3x\, \epsvx(\partial_\beta \vect A_\beta - \nabla\Lambda_\beta)^2 \right].
\end{align}
Initially I missed the factor of $\epsvx^{3/2}$, which I discovered by reading a paper by Bordag on path integral quantization in dielectric media \cite{Bordag1998}.
Since we will eventually be taking the ratio of this partition function to it's vacuum couterpart, any constant terms involving $\pi, \hbar, etc$ will cancel out.  

Shortly we will introduce a path integral notation.
  We are integrating over all field configurations, and at all points in space.
  We will introduce a notation
\begin{equation}
\int D \vect{A} D\Lambda\epsvx^{3/2} = \prod_{i=1}^N\prod_{x_k}\int d\vect{A}(\vect{x}_k,\beta)
\int d\Lambda(\vect{x}_k,\beta)\epsilon^{3/2}(\vect{x}_k),
\end{equation}
where the product $\vect{x}_k$ runs over all positions $\vect{x}\in \mathbb{R}^3$  and ranges of $\beta'\in[0,\beta)$.  

If we take the product of all of the matrix elements, then the total path integral is given by 
\begin{equation}
Z = \int D\vect A D\Lambda\, \epsvx^{3/2}\exp\left[-\frac{\epsilon_0}{2\hbar^2}\int d^3x\int_0^\beta d\beta\,
\epsvx\left(\partial_\beta\vect A-\nabla\Lambda\right)^2+\hbar^2c^2(\nabla\times\vect A)^2\right].  
\end{equation}
We can change variables to $x_4=\beta\hbar c$, and $A_4 = \Lambda/\hbar c$. 
 Note that $A_4$ now has the same dimensions as $\vect{A}$.
  We can also see that $x_4$ is the thermal de-Broglie wavelength, up to a factor of $2\pi$.  
\begin{equation}
Z = \int D^4A\, \epsvx^{3/2}\exp\left[-\frac{\epsilon_0c^2}{2\hbar c}\int d^4x\,
\epsvx\left(\partial_4\vect A-\nabla A_4\right)^2+(\nabla\times\vect A)^2\right].
\end{equation}

We will compare this partition function to the case when the objects are infinitely far apart,
 which we will denote as $Z_0$.
  The objects will still be present in the space, but they will be too far away to interact significantly.  

We can write the $\epsvx$ term as a functional determinant,
 since it is a product $\prod_{sites}\epsilon(x_k)$.
  If we move the objects far apart from each other, 
this product will note change value since we are merely swapping vacuum and material regions.
  Ultimately we will calculate 
\begin{equation}
E-E_0 = -\lim_{\beta\rightarrow 0}\frac{1}{\beta} \log Z-\log Z_0.
\end{equation}
Since the constants $\det\epsilon$ will be the same in both cases, these will cancel out.
  We can then ignore them and consider 
\begin{equation}
Z = \int D^4A\, \exp\left[-\frac{\epsilon_0c^2}{2\hbar c}\int d^4x\,
\epsvx\left(\partial_4\vect A-\nabla A_4\right)^2+(\nabla\times\vect A)^2\right].
\end{equation}

\section{The Path Integral and Gauge Freedom}
From work done over November (2011?), we have 
 \begin{equation}
 Z = \int D\vect{\widetilde{A}} D\phi e^{-S_E[\vect{\widetilde{A}},A_4]},
 \end{equation}
where the Euclidean action is 
\begin{equation}\label{eq:euclidean_action}
S_E[\vect{\widetilde{A}},\phi] = \frac{\epsilon_0c}{2\hbar} \int d^4x\, 
\epsilon\left( \partial_4\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}}-\nabla A_4\right)^2
+\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}}\cdot\nabla\times\nabla\times\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}},
\end{equation}
where we are using $\vect{\widetilde{A}} = \vect A/\sqrt{\epsilon}$, 
where $\vect A$ is the usual vector potential.
  This change of variable was necessary after the integral over the conjugate momentum fields.
    We have already used all of the constraints on the fields to write the equations in this form. 
We are using the euclidean path integral, with $x_4=\beta$.

We need to enforce a gauge condition, since currently the path integral runs over all field configurations.
  The integral includes physically equivalent states that are related to each other by a gauge transformation.
  We will then only integrate over one point from the gauge fibre by enforcing a delta-function constraint.  

The gauge transformation can be written as 
\begin{equation}
A'^\mu \rightarrow A^\mu +\partial^\mu\alpha,
\end{equation}
where $\alpha$ is an arbitrary function.
  In 3-vector notation this gives
\begin{subequations}
\begin{align}
A_4' &= A_4+\partial_4\alpha\\
\vect A' &= \vect A + \nabla\alpha.
\end{align}
\end{subequations}
This change of variables does not change the value of the path integral.
  We only want to sum over one of each physical configuration, so we can imagine integrating over the redundant $\alpha$ variables.  

If we start with a gauge constraint $G[A^\mu]$, we can write this in terms of the $A^\mu$ and $\alpha$ as $G[A^\mu+\partial^\mu\alpha]$.
  To get the correct measure after integrating over all $\alpha$ we must use the functional generalization of the change of variable for a single delta function:
\begin{equation}
\int dx \delta(f(x)) = \int df \frac{1}{|\partial_xf|}\delta(f).
\end{equation}
Since we will integrate over all redundant alpha we need to cancel off that Jacobian factor.
  We will use the following delta-function for the integral over $A$
\begin{equation}
\delta(G[A])\det\left(\frac{\delta G[A]}{\delta\alpha}\right).
\end{equation}
The path integral becomes 
\begin{equation}
 Z = \int D\vect{\widetilde{A}} DA_4\, \det \frac{\delta G}{\delta \alpha} e^{-S_E}.
 \end{equation}
We can put this in the usual form with yet another trick.
  Let us choose a gauge where $G[A]-\omega(x) =0$.
   We can also insert unity in the form of a Gaussian integral:
\begin{equation}
  1 = \int D\omega \exp\left[-\int d^4x\, \omega^2(x)\right],
\end{equation}
where any constant factors are assumed to be absorbed into the normalization of the path integral.
  The gauge-fixed path integral finally becomes
\begin{equation}
 Z = \int D\vect{\widetilde{A}} DA_4\, \det \frac{\delta G}{\delta \alpha} 
\exp\left[-S_E-\frac{\epsilon_0 c}{2\hbar}\int d^4x\, G^2\right].
\end{equation}
 The functional determinant is often turned into an integral over anti-commuting Grassman variables \cite{Srednicki2008}.
  This is only truly necessary for non-Abelian fields where the gauge transformation will depend on the field variables.
  For electromagnetism, which is an abelian gauge field theory the functional determinant decouples from the dynamics.
  Nonetheless, we ned to keep track of this determinant to correctly count the degrees of freedom.
  We will ignore the determinant from the delta function when the gauge is independent of $\epsilon$.
  However, if we choose a gauge that depends on $\epsilon$, then the determinant will depend on the configuration of external bodies and we cannot ignore it.  

\subsection{Gauge Choices}
Overall, the path integral is independent of our choice of gauge,
 and it would be nice to show that you get the same results in two different gauges.
  I have come across the following gauge choices:
\begin{itemize}
\item Coulomb Gauge: $\nabla\cdot\vect A=0$. \\
This gauge is the familiar choice in non-relativistic quantum optics.
  The potential decouples from the vector field, which only has two transverse degrees of freedom.
  While this is a good choice in free space, it is complicated by the presence of $\epsvx$.
  You find for general $\epsilon$ that $\vect A$ is coupled to $A_4$, which ends up requiring some messy work with Green functions to get around.
  The functional determinant won't depend on epsilon so we can ignore it, 
since it will cancel out when we consider the difference between the vacuum energy and the energy when bodies are present.  

\item Generalized Coulomb Gauge: $\nabla\cdot\epsilon\vect A=0$\\
  This is the natural choice if you allow the dielectric to vary spatially.
  This is in fact the choice used in other attempts to quantize the EM field inside 
a dielectric~\cite{Knoell1987, Glauber1991}.
  Note that in those cases, they have $\nabla\cdot\epsilon\vect A'=0$,
 while our vector potential is scaled, $\vect{\widetilde{A}} = \sqrt{\epsilon}\vect A'$.
  This choice removes any coupling between $\vect{\widetilde{A}}$ and $A_4$.
  As can be seen from the equations of motion.
  The functional determinant then depends on $\epsilon$, so we should track it.
  Unfortunately, this is not susceptible to the above gauge-fixing techniques.
  Generalized Lorenz gauge solves that issue, and is how we have proceeded.  

\item Temporal Gauge: $A_4=0$.  
This gauge simply removes the scalar field, and rolls all of that dependence into the longitudinal part of $\vect A$.
  Ramond claims that this does not fully specify the gauge of the field~\cite{Ramond1990}, which I should check into more.
  Surprisingly, this does seem to be a fairly common gauge for people working with path integrals in dielectrics~\cite{Bechler1999,Rahi2009}.
  However, it is not a complete gauge fixing so we will not pursue it any further.  

\item Bordag's generalized Lorenz gauge: 
    $\frac{1}{\epsilon}\nabla\cdot\epsilon\vect A + \epsilon\partial A_4=0$.
   Bordag \textit{et.~al.} used this gauge in a calculation of the heat kernel for the EM field in a linear dielectric.
   This gauge choice has the advantage of also removing any coupling between $\vect A$ and $A_4$.
  It has the downside of introducing some extra terms in the energy for $A_4$.
  This is effectively a generalized Lorenz gauge.
  I'm not sure why they need the extra factors of $\epsilon$.
  The determinant will depend on $\epsilon$, so we cannot drop the determinant.  

\item Generalized Lorenz Gauge: $\nabla\cdot\epsilon\vect A + \partial A_4=0$.
  This removes the coupling between $\vect{A}$ and $A_4$.
  It's form is chosen to cancel the cross term in the first quadratic piece of Eq. (\ref{eq:euclidean_action}).
  It also gives the same functional determinant as the $A_4$ integral, which allows a partial cancellation of terms.  
\end{itemize}

\section{Gauge-Fixing: Generalized Lorenz Gauge}
We will enforce a generalized Lorenz gauge,
\begin{equation}
G[A]=\nabla\cdot\epsilon(\vect{x})\vect{A}+\partial_4A_4 = 0
\end{equation}
in the path integral.  Let us make a gauge transformation on this,
\begin{equation}
G[A+\partial \alpha] = \nabla\cdot[\epsilon(\vect{x})(\vect{A}+\nabla\alpha)]+\partial_4(A_4+\partial_4\alpha).
\end{equation}
We can then read off the functional derivative:
\begin{equation}
\frac{\delta G}{\delta \alpha} = \nabla\cdot\epsilon(\vect{x})\nabla + \partial_4^2.
\end{equation}
Recall that we need to use the absolute value of this.
  The negative of this operator is actually the positive operator $(-\nabla^2$ has eigenvalues $k^2$).
  In terms of the scaled field variables the gauge condition is
\begin{equation}
\nabla\cdot\sqrt{\epsilon}\vect{\widetilde{A}}+\partial_4A_4 = 0,
\end{equation}
with the same expression for the divergence of $\vect{\widetilde{A}}$.  

The gauge-fixed Euclidean action becomes 
\begin{align}
S_E &= \frac{\epsilon_0 c}{2\hbar}\int d^4x
\left(\partial_4\vect{\widetilde{A}} - \sqrt{\epsilon}\nabla A_4\right)^2
 + \left(\nabla\times\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}}\right)^2
+\left(\partial_4A_4+\nabla\cdot\sqrt{\epsilon}\vect{\widetilde{A}}\right)^2\\
&=\frac{\epsilon_0 c}{2\hbar}\int d^4x\,|\partial_4\vect{\widetilde{A}}|^2 
+(\nabla\cdot\sqrt{\epsilon}\vect{\widetilde{A}})^2 +[\partial_4A_4]^2+\epsilon|\nabla A_4|^2
 + \left(\nabla\times\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}}\right)^2
\end{align}
The term in $A_4$ can be rewritten as 
\begin{equation}
\int d^4x [\partial_4A_4]^2+\epsilon|\nabla A_4|^2 = \int d^4x\, A_4\left(-\nabla\cdot\epsilon\nabla-\partial_4^2\right)A_4,
\end{equation}
at the cost of some boundary terms which are assumed to vanish.  
We can now (at least formally) evaluate the Gaussian integral over $A_4$ and write 
\begin{equation}
\int D A_4 \exp\left[-\int d^4x \,A_4\left(-\nabla\cdot\epsilon\nabla-\partial_4^2\right)A_4\right] \propto \det{}^{-1/2}
\left(-\nabla\cdot\epsilon\nabla-\partial_4^2\right).
\end{equation}
will is identical to the term in the functional determinant from normalizing the functional delta function.
  This result follows from thinking about the following finite dimensional Gaussian integral,
\begin{align}
\int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] = \int d\vect{z} \det[O] \exp[-\vect{z}^TO^TMOz]
\end{align}
If we assume $M$ is Hermitian, we can find its eigenvalues and eigenvectors.
  If we choose $O$ to diagonalize $M$, we have decomposed $\vect{y}$ into the eigenvectors of $M$.
  This is an orthogonal transformation, and the determinant $\det O$ is unity.
  The eigenvectors are orthogonal, so they decouple and the integral becomes a product of simple Gaussian integrals.   
\begin{align}
\int d\vect{z}\exp[-\vect{z}^T\Lambda\vect{z}]=\prod_k\int dz_k \exp[ -\lambda_kz_k^2] =  \prod_k \sqrt{\frac{\pi}{\lambda_k}},
\end{align}
where we have defined the diagonal matrix $\Lambda=O^TMO$.
   The determinant of $\Lambda$ is just the product of its diagonal elements - which is exactly what we found as the result of the integral.  We can now invert the orthogonal transformations to write 
\begin{equation}
\int d\vect{y} \exp[ -\vect{y}^TM\vect{y}] \propto \det{}^{-1/2}M
\end{equation}
Now note that the result of the $A_4$ integral is the same as the functional determinant from fixing the gauge - this is the reason for choosing to use a slightly different gauge to Bordag.
 
Similarly, The terms involving $\epsilon\vect{\widetilde{A}}$ now become
\begin{align} \int d^3\vect{x}\,\left(\nabla\times\frac{\vect{\widetilde{A}}}{\sqrt{\epsilon}}\right)^2+(\nabla\cdot\sqrt{\epsilon}\vect{\widetilde{A}})^2& = \int d^3\vect{x}\,\widetilde{A}_i\left[-\frac{1}{\sqrt{\epsilon}}\nabla^2\frac{1}{\sqrt{\epsilon}}\delta_{ij} + \frac{1}{\sqrt{\epsilon}}\partial_i\partial_j\frac{1}{\sqrt{\epsilon}}-\sqrt{\epsilon}\partial_i\partial_j\sqrt{\epsilon} \right] \widetilde{A}_j
\end{align}
So the partition function now becomes:
\begin{align}
Z &= \int D\vect{\widetilde{A}} DA_4\, \det[-\partial_4^2-\nabla\cdot\epsilon\nabla]
 \exp\left[-\int d^4x \mathcal{L}\right]\\
&=C\det\left[-\partial_4^2-\nabla\cdot\epsilon\nabla\right]^{1/2}
\det\left[-\left(\partial_4^2+\frac{1}{\sqrt{\epsilon}}\nabla^2\frac{1}{\sqrt{\epsilon}}\right)\delta_{ij}
 + \frac{1}{\sqrt{\epsilon}}\partial_i\partial_j\frac{1}{\sqrt{\epsilon}}
-\sqrt{\epsilon}\partial_i\partial_j\sqrt{\epsilon} \right]^{-1/2},
 \end{align}
where $C$ absorbs all of the constant pieces.  

We can recover the vacuum result by setting $\epsilon=1$ everywhere.  This yields
\begin{equation}
Z_0 = C\det\left[-(\partial_4^2+\nabla^2)\right]^{1/2}
\det\left[-\left(\partial_4^2+\nabla^2\right)\delta_{ij} \right]^{-1/2}
\end{equation}
If we now use $\det{A\delta_{ij}} = [\det{A}]^3$, we see that 
\begin{equation}
Z_0 = -\det[-(\partial_4^2+\nabla^2)],
\end{equation}
which is twice the energy of a free massless scalar field.
  This makes sense, a free electromagnetic field has two massles degrees of freedom that obey the Klein-Gordon equation, so you'd expect twice the vacuum energy.  

    \section{Zero temperature, dispersion-less}
    \section{Dispersion and finite temperature}
    \section{Polarization decomposition}


\chapter{Scalar Decomposition of EM: Partition Functions}

\section{TE energy as scalar}

Recall that the total energy for the EM field in a dielectric is 
\begin{equation}
H = \frac{1}{2}\int dx \frac{\Pi^2}{\epsilon} + c^2(\nabla\times\vect{A})^2 = \frac{1}{2}\int dx \frac{ D^2}{\epsilon} + c^2 B^2
\end{equation}

We assume an atom interacts with the electric field via $H_{int} = -\vect{d}\cdot\vect{E}$.  From second order perturbation theory, in the far field limit we get
\begin{equation}
V_{CP} = -\frac{1}{2}\alpha_0\langle |\vect{E}|^2\rangle.
\end{equation}
Our goal is to evaluate $\langle E^2\rangle$ from the thermodynamic partition function.  

If we consider a planar geometry, we can split the modes into TE and TM modes.  With $\vect{E} = E_y\vect{y}$.  From $\nabla\times \vect{H} = \partial_t \vect{D}$ and $\nabla\times\vect {E} = -\partial_t\vect{B}$.  We would like an expression for $B.$

If we assume the usual frequency dependence, and decompose the fields into monochromatic plane waves we get 
\begin{equation}
-i\omega \vect{B} = i\vect{k}\times\vect{E}  
\end{equation}
As magnitudes we get 
\begin{equation}
B^2 = \frac{k^2}{\omega^2}E^2(k) = -\frac{1}{\omega^2}(\nabla E_y)^2
\end{equation}
I think our scalar in this case is just $A_y$.  With all others $A_x=A_z=\phi=0$.  SInce we must also have $\nabla\cdot\vect{A} = 0$, we can add $\partial_y A_y=0$ everywhere with impunity.  

\subsection{Equivalent scalar Hamiltonian}
If we take $E_y = \partial_t\phi$, then $B=\nabla\times \vect{A}$.  So if we started with a Lagrangian,
\begin{equation}
L = \frac{1}{2}\int dx \, \epsilon(\partial_t\vect{A})^2 - c^2(\nabla\times\vect{A})^2
\end{equation}
for this problem we can replace this with an action for the scalar field
\begin{equation}
L = \int dx \, \epsilon(\partial_t\phi)^2 - c^2(\nabla\phi)^2
\end{equation}
where $A_y = \phi$.  This conjugate momentum: $\Pi = \epsilon\partial_t\phi$.  The Hamiltonian is 
\begin{equation}
\boxed{H = \int dx \frac{\Pi^2}{2\epsilon} + c^2|\nabla\phi|^2}
\end{equation}


\subsection{Partition function goes to determinant}
Let's now evaluate the partition function $Z$.  We will be able to get the mean energies we want from here.  We will put this into a form that is amenable for both Casimir-Polder and Casimir energies.  
\begin{align}
Z =& \int D\phi D\Pi\, \, \exp\left[-\int_0^\beta d\beta' \int dx \frac{\Pi^2}{2\epsilon}+\frac{c^2}{2}|\nabla\phi|^2 + \frac{i}{\hbar}\partial_\beta\phi \Pi\right]\\
=& \det[\epsilon]^{-1/2}\int D\phi\, \, \exp\left[-\frac{c^2}{2}\int_0^\beta d\beta' \int dx \frac{\epsilon}{\hbar^2 c^2}\partial_\beta\phi^2+c^2|\nabla\phi|^2 \right],
\end{align}
where we carried out the Gaussian integral in $\Pi$.  We will introduce a ``temperature length'' $\tau = \beta \hbar c$ for consistency of units later, and evaluate the remaining Gaussian integral. 
\begin{align}
Z(s)=& \det[\epsilon]^{-1/2}\int D\phi\, \, \exp\left[-\frac{c}{2\hbar}\int_0^{\beta\hbar c} d\tau \int dx\, \epsilon\partial_\tau\phi^2+|\nabla\phi|^2 \right]\\
=& \det[\epsilon]^{-1/2}\det\left(-\frac{1}{2}\epsilon\partial^2_\tau -\frac{1}{2}\nabla^2\right)^{-1/2}
\end{align}
Breaking with the past, I have left the factor of $\frac{1}{2}$ in the determinant.  This ensures that our path integral just uses Brownian bridges, without the need for further rescaling.  

\subsection{Log-det goes to particle path integral}
Now use 
\begin{equation}
\log \det A -\log \det B = -\int_0^\infty\frac{dT}{T}\tr e^{-AT}+\int_0^\infty\frac{dT}{T}\tr e^{-BT}
\end{equation}
So we have 
\begin{equation}
\log Z =  \frac{1}{2}\int_0^\infty\frac{dT}{T}\int dx\langle x| e^{\epsilon\partial^2_\tau +\nabla^2T}|x\rangle
\end{equation}
Here we assumed that the two reference configurations, have the same bodies, just rearranged.  In this case $\det[\epsilon(x)] = \prod_k \epsilon(x_k)$ is unchanged when we move the objects around.  So that leading determinant cancels out.  

We can convert this to a path integral with identifying the differential operators as momentum operators, introducing an auxialiary Hilbert space, $\langle x| \op{p}|\psi\rangle = -i\partial_x \psi(x)$, with $[x,p]=i$.  Then $\langle x|p\rangle = e^{ipx}$, and $I_x=\int dx|x\rangle\langle x|$, and $I_p = \int dp/(2\pi)dp\,|p\rangle\langle p|$.  

\begin{align}
\log Z =& \frac{1}{2}\int_0^\infty\frac{dT}{T} \int d^3x_0d\tau_0 \int \frac{d^3x_kd^3p_k d\tau_kdp_{\tau,k}}{(2\pi)^4} \delta^{(4)}(x_0-x_N)e^{-\sum_j \left(p_j^2\Delta T +\epsilon(x_j)p_{j,\tau}^2\Delta T + ip_\tau(j)\Delta\tau_{j} + ip_(j)\Delta x_{j}\right)}\\
=& \frac{\beta \hbar c}{2}\int_0^\infty\frac{dT}{T} \int d^3x_0\int \frac{dx_k d\tau_k}{(2\pi\Delta T)^2\sqrt{\epsilon(x_k)}} \delta^{(4)}(x_0-x_N) e^{-\sum_k \frac{(x_{k+1}-x_k)^2}{2\Delta T}}e^{-\frac{(\tau_{k+1}-\tau_k)^2}{4\epsilon_k\Delta T}},
\end{align}
where we evaluated the Gaussian momentum integrals, and used $\int_0^{\beta\hbar c} d\tau_0 = \beta\hbar c$.  
We can evaluate the Gaussian integrals over $\tau_k$, noting that these are just coupled Gaussians - the spatial dependence dose not affect these integrals.  

\begin{equation}
\log Z_{TE} -\log Z_0= \frac{\beta \hbar c}{8\pi^2}\int \frac{dT}{T^3}\left<\left< \frac{1}{\langle\epsilon\rangle_{\text{loop}}^{1/2}} - 1 \right>\right> \label{eq:log Z TE}
\end{equation}


\section{Scalar TM}

\comment{signs with complex variables?}
In this case we have a TM field.  We will try to turn the electromagnetic energy into an equivalent scalar problem.  In this case we can use 
If we consider a planar geometry, we can split the modes into TE and TM modes.  With $\vect{H} = H_y\vect{y}$.  From $\nabla\times \vect{H} = \partial_t \vect{D}=\epsilon\partial_t\vect{E}$ and $\nabla\times\vect {E} = -\partial_t\vect{B}$.  We would like an expression for $E^2$ in terms of $H$, which is a scalar.  

If we assume the usual frequency dependence we get 
\begin{equation}
-i\mu_0\epsilon_0\omega \epsilon\vect{E}(\omega) = \vect{\nabla}\times\vect{B}  
\end{equation}
If we dot this equation into it's conjugate  we get 
\begin{align}
(\mu_0\epsilon_0)^2\omega^2\epsilon^2|\vect{E}(\omega)|^2 = |\nabla\times\vect{B}(\omega)|^2 
\end{align}

Now with $B = B_y\vect{y}$, we can use $\nabla \times \vect{B} = (-\partial_zB_y, 0, \partial_x B_y)$.  We also have $\nabla\cdot B = 0$, so we can add $\nabla\cdot B = \partial_y B_y=0$.
\begin{align}
(\mu_0\epsilon_0)^2\omega^2\epsilon^2\vect{E}^2 =& (\nabla\times\vect{B})^2 = (\nabla B_y)^2\\
\Aboxed{|\vect{E}|^2 =&  \frac{1}{(\mu_0\epsilon_0)^2\omega^2\epsilon^2}(\nabla B_y)^2}
\end{align}
\comment{signs - E is real.  }
Let's take $B_y = \partial_t\phi$.
Let's introduce 
\begin{equation}
B_y(t) = i\int d\omega\,\omega  \phi(x,\omega) e^{-i\omega t} = -\partial_t\phi(t)
\end{equation}
Then we have 
\begin{equation}
\partial_t\vect{E} = \nabla\times \partial_t\phi\vect{y} = \partial_t (\nabla\times\phi\vect{y})
\end{equation}
So we get $|\vect{E}|^2 = (\nabla\phi)^2$.  



The Lagrangian is then 
\begin{align}
L_{TM} =& \frac{1}{2}\int dx \epsilon \vect{E}^2  - c^2 \vect{B}^2\\
 =& \frac{1}{2}\int dx \int \frac{d\omega}{2\pi}\epsilon |\vect{E}(\omega)|^2  - c^2B_y^2(\omega)\\
=& \frac{1}{2}\int dx \frac{c^4}{\epsilon\omega^2}(\nabla B_y)^2  - c^2B_y^2\\
=& \frac{c^2}{2}\int dx\,\partial_t\phi^2-\frac{c^2}{\epsilon}(\nabla\phi)^2
\end{align}
using only terms with equal frequencies survive trace.  

The momentum is then $\Pi = c^2\partial_t\phi$, so we will get a negative quantity?!

The \comment{sign-corrected} Hamiltonian is then 
\begin{align}
\boxed{H = \frac{1}{2}\int dx \Pi^2 + c^2\frac{1}{\epsilon} \nabla\phi^2}
\end{align}

The partition function is 
\begin{equation}
Z_{TM} = \int D\phi \exp\left[-\int d^4x\,\frac{1}{2} \partial_\tau\phi^2 + \frac{1}{2}\epsilon^{-1}\nabla\phi^2\right]
\end{equation}
Rescale the fields:
\begin{equation}
Z' = \det[\epsilon]^{1/2}\int D\phi \exp\left[-\frac{1}{2}\int d^4x \epsilon\partial_\tau\phi^2 + \epsilon^{-1}\nabla\sqrt{\epsilon}\phi^2\right]
\end{equation}

Now have the functional determinant:
\begin{equation}
\log Z_{TM} = -\frac{1}{2}\tr\log\left[ -\frac{1}{2}\partial_\tau\epsilon\partial_\tau -\frac{1}{2}\sqrt{\epsilon}\nabla\epsilon^{-1}\nabla\sqrt{\epsilon}\right]
\end{equation}
We will leave the factor of $1/2$ so that we have normal brownian loops.  Our normal calculations compare against this case, and it will leave us with fewer rescalings to worry about.  

This is a path integral:
\begin{align}
\log Z_{TM} =& \frac{1}{2}\int_0^\infty \frac{dT}{T}\int dx_0\int D^4x D^4p e^{-p_\tau^2\epsilon\Delta T +ip_\tau\Delta \tau -\sqrt{\epsilon}\vect{p}\epsilon^{-1}\vect{p}\epsilon\Delta T + i\vect{p}\vect{\Delta x}}\\
=& \frac{1}{2}\int_0^\infty \frac{dT}{T}\int d^4x_0 \int \prod_{k=1}^N \frac{d^4x_k d^4p_k}{(2\pi)^4} \delta^4(x_N-x_0)e^{-\frac{1}{2}p_{\tau,k}^2\epsilon(x_k)\Delta T +ip_{k\tau}\Delta \tau_k} e^{ -\frac{1}{2}\sqrt{\epsilon}\vect{p}\epsilon^{-1}\vect{p}\epsilon\Delta T + i\vect{p}\vect{\Delta x}}
\end{align}

Let's now operator order that exponent.  This will generate a potential which is important.  
\begin{align}
\epsilon^{1/2} p\epsilon^{-1} p\epsilon^{1/2} =& p\epsilon^{-1/2}p\epsilon^{1/2} + \frac{i}{2}\epsilon'\epsilon^{-1/2}\epsilon^{-1}p\epsilon^{1/2}\\
=& p^2 +ip\epsilon^{1/2}\frac{-\epsilon'}{2\epsilon^{3/2}} + \frac{i\epsilon'}{2\epsilon^{3/2}}p\epsilon^{1/2}\\
=& p^2 -ip\epsilon^{1/2}\frac{\epsilon'}{2\epsilon^{3/2}} + p\frac{i\epsilon'}{2\epsilon^{3/2}}\epsilon^{1/2}-\epsilon^{1/2}\left(\frac{\epsilon'}{2\epsilon^{3/2}}\right)'\\
=& p^2 +\left(\frac{3\epsilon'^2}{4\epsilon^{2}} - \frac{\epsilon''}{2\epsilon}\right)
\end{align}

Now compare this to 
\begin{align}
\log(\sqrt{\epsilon})'' =& \left(\frac{\epsilon'}{2\epsilon}\right)' = \frac{\epsilon''}{2\epsilon} - \frac{\epsilon'^2}{2\epsilon^2}\\
[\log\sqrt{\epsilon}']^2 =& \frac{\epsilon'^2}{4\epsilon^2}
\end{align}

We can then say that 
\begin{equation}
\frac{1}{2}\epsilon^{1/2} p\epsilon^{-1} p\epsilon^{1/2}  = \frac{1}{2}p^2 + \frac{1}{2}\left[(\nabla\log\sqrt{\epsilon})^2 - \nabla^2\log\sqrt{\epsilon} \right]= \frac{1}{2}p^2 + V_{TM}
\end{equation}

%You can evaluate this either way, either by explicitly Ito ordering, or Weyl ordering.  For Weyl ordering, you can then treat the velocity term as a shift, which induces a potential.  This follows from expanding expressions for the logarithm.  Either way, you get the same answer.  

We then have a gaussian path integral.  We can evaluate all of the integrals over the momenta, $\vect{p}$, and $p_\tau$.  
\begin{align}
\log Z_{TM} =& \frac{\beta\hbar c}{2}\int_0^\infty \frac{dT}{T}\int d^4x_0 \int \prod_{k=1}^N \frac{d^4x_k d^4p_k}{(2\pi)^4} \delta^4(x_N-x_0)e^{-\frac{1}{2}p_{\tau,k}^2\epsilon(x_k)\Delta T +ip_{k\tau}\Delta \tau_k} e^{ -\frac{1}{2}\vect{p}^2\Delta T + i\vect{p}\vect{\Delta x} -V_{TM}(x_k)\Delta T}\\
 =& \frac{1}{2}\int_0^\infty \frac{dT}{T}\int d^4x_0 \int \prod_{k=1}^N d^4x_k \delta^4(x_N-x_0)\frac{1}{\sqrt{2\pi\epsilon_k \Delta T}}e^{-\frac{\Delta \tau_k^2}{2\epsilon_k\Delta T}}\frac{1}{(2\pi\Delta T)^{3/2}}e^{ -\frac{\Delta x_k^2}{2\Delta T}-V_{TM}(x_k)\Delta T}\\
\end{align}

We can immediately carry out the $\tau$ gaussian integrals, using 
\begin{equation}
\int \prod_{k=1}^Nd\tau_k\delta(\tau_N-\tau_0)
\frac{1}{\sqrt{2\pi\epsilon_{k-1}\Delta T}} 
e^{-\frac{\epsilon_{k-1}(\tau_{k}-\tau_{k-1})^2}{2\Delta T}} 
= \frac{1}{\sqrt{2\pi \Delta T\sum_k \epsilon_k}} 
= \frac{1}{\sqrt{2\pi T}\langle \epsilon\rangle^{1/2}}
\end{equation}

So the path integral becomes 
\begin{equation}
\log Z = \frac{1}{2}\int_0^\infty\frac{dT}{T}\int dx_0\int D^3x
 \frac{e^{-\frac{\vect{\Delta x}^2}{2\Delta T} -V_{TM}\Delta T}}{\langle\epsilon\rangle^{1/2}}
\end{equation}

Normalize against open loops:
\begin{equation}
\log Z_{TM} = \int_0^\infty \frac{dT}{8\pi^2T^3}\int dx_0\left<\left< 
\frac{e^{ -T\langle V_{TM}\rangle}}{\langle\epsilon\rangle^{1/2}}\right>\right>
\label{eq:log Z TM}
\end{equation}
where 
\begin{equation}
\langle V_{TM} \rangle = \frac{1}{T}\int_0^Tdt\,\frac{1}{8}|\nabla\log\epsilon|^2
 - \frac{1}{4}\nabla^2\log\epsilon\label{eq:TM potential}
\end{equation}


\section{Path Integrals in Curved Space}

In this section we will show that the potential $\VTE$ naturally emerges if we
work in a curved space.  
The problem of computing the path integral for a 
particle in curved space was first considered by deWitt~\cite{deWitt1957}.  
In a curved space, the position and momentum  operators take on slightly 
different forms reflecting the differing inner product.  
Let us follow Pauli to see one way towards handling this~\cite{Pauli1958}.  

Let us consider a curved space, with generalized coordinates $q_i$.  The metric
tensor $g_{ij}$ then gives the notion of distance, $ds^2 = g_{ij}dq^idq^j$.  
In a curved space, the volume element is $\sqrt{|g|}\prod_idq_i$, where $g=\det(g_{ij})$.   

The identity on the coordinates is 
\begin{equation}
 I_q := \int d\vect{q}\sqrt{|g|} |\vect{q}\rangle\langle {q}|
\end{equation}
This implies that the wavefunction overlap for two states $|\phi\rangle,|\psi\rangle$
is 
\begin{equation}
\langle \phi|\psi\rangle = \int d\vect{q}\sqrt{|g|} \phi^*(\vect{q})\psi(\vect{q}).
\end{equation}
In order for the identity to be idempotent ($I_q^2 = I_q$), this requires that
the overlap between coordinate eigenstates is 
\begin{equation}
\langle \vect{q}|\vect{q'}\rangle = \frac{1}{\sqrt{|g|}}\delta(\vect{q}-\vect{q}')
\end{equation}

The position and momentum operators should be hermitian, and obey the 
canonical commutation relations, 
\begin{equation}
[\op{q}_i,\op{p}_j]=i\hbar\delta_{ij}.
\end{equation}
If we define the position operators such that 
\begin{equation}
\langle \vect{q'}|\op{q}|\psi\rangle=\vect{q'}\langle \vect{q'}|\psi\rangle,
\end{equation}
then we can infer from the commutation relations, and the hermiticity condition
that the momentum operators are given by
\begin{align}
\langle\phi|\op{p}_i|\psi\rangle = \int d\vect{q}\sqrt{|g|}\phi^*(\vect{q})
\frac{1}{\sqrt{|g|}}\frac{\partial}{\partial q_i}\sqrt{|g|}\psi(\vect{q}).  
\end{align}
The presence of the extra factors of $\sqrt{|g|}$ ensures that the 
$\langle\phi|(\op{p}_i|\psi\rangle = (\langle \phi|\op{p}_i^\dag)|\psi\rangle$,
which follows from the integral represenation via an integration by parts.  

An alternative method of setting up the path integral in curved space is to 
transform that flat-space path integral to curvilinear coordinates~\cite{Gervais1976,Girotti1983}.  
The main concern in this approach is to consistently work to $\order(\Delta T)$.  
Given the typical Gaussian path measure, which implies $\Delta x^2 \sim \Delta T$, 
this requires us to also Taylor expand up to fourth order in spatial 
functions~\cite{McLaughlin1971}.    

Let us consider the following action
\begin{equation}
  S = \frac{m}{2}g_{ij}(\vect{q})\dot{q}_i\dot{q}_j - V(x)
\end{equation}
We will find the 


\begin{itemize}
\item Lagrangian.
\item Momentum
\item Hamiltonian.  Note $pgp$ structure.  Operator ordering problem in curved space.  
  Have classical equations, with ambiguous ordering (and tiny, tiny consequences)
  for different choices.  
\item Wave equation is Laplace-Beltrami operator (what you get from changing coords
  -motivates Gervais approach.  
\item DeWitt: Path integral is kernel of appropriate Schrodinger equation.
\item Kleinert, transformation useful in curvilinear coordinates. (path integral
  for hydrogen atom.
\end{itemize}

\section{Harmonic Medium}

In this section we will attempt to carry out the full quantization procedure for a harmonic
medium.  We will start from a gauge-invariant Lagrangian for the electromagnetic field coupled
to a medium. 
We will derive the Hamiltonian, and then compute the partition function.
 We will then gauge-fix, and integrate out the harmonic medium.  This is essentially
based on the approach of deriving the dielectric via linear response theory advocated in Rosa~\etal\cite{Rosa2008}.
We will integrate out the matter-fields, and treat the interaction out to second order in the interaction.  
We will then carry out the remaining integral over the fields.  

This method should be well-defined perturbation theory, and follow the usual physical reasoning.  This
should avoid any of the strange features of trying to quantize the field while it is already
interacting with an effective medium.  

The combined field-matter Lagrangian for the EM field interacting with a charged scalar field is
\begin{align}
  L =& \int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_t\vect{A})^2
  - \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
&+\bigg(\partial_t+i\frac{e}{c}A_0\bigg)\phi^*\bigg(\partial_t-i\frac{e}{c}A_0\bigg)\phi
- \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
-\phi^*(u(x)+m^2)\phi\bigg],
\end{align}
where there is a potential $u(x)$ binding the charged scalar to exist only in certain regions.  We
will take $u(x)=0$ inside the bodies, and $u(x)\rightarrow\infty$ outside the bodies.  
The action is invariant under the combined gauge transformations,
\begin{align}
 A_0&\rightarrow A_0-\partial_t\alpha\\
\vect{A} & \rightarrow \vect{A}+\nabla\alpha\\
\phi &\rightarrow e^{-i\frac{e}{c}\alpha}\phi.
\end{align}

The canonical momenta are found to be
\begin{align}
  \pi_0 &:= \frac{\delta L}{\delta (\partial_t A_0)} = 0\\
  \vect{\Pi} & := \frac{\delta L}{\delta(\partial_t\vect{A})} = \epsilon_0(\nabla A_0+\partial_t\vect{A})\\
  \vect{\pi} & := \frac{\delta L}{\delta(\partial_t\phi)} = \bigg(\partial_t+i\frac{e}{c}A_0\bigg)\phi^*.
\end{align}
As noted before, the vanishing of $\pi_0$ is a constraint which must be maintained by the dynamics.
Preserving this constraint will require that $\partial_t\vect{\Pi}=\nabla\cdot\vect{\Pi}=0$.
We will employ the Gupta-Bleuler quantization, which restricts the allowed states. 

The full Hamiltonian is 
\begin{align}
  H &:= \int d\vect{x}(\pi_0 \partial_t A_0+\vect{\Pi}\cdot\partial_t\vect{A}+\pi\partial_t\phi 
  +\pi^*\partial_t\phi^*) - L\\
%   &:= \int d\vect{x}\bigg[\vect{\Pi}\cdot\frac{(\Pi-\nabla A_0)}{\epsilon_0}
%   +\pi(\pi^*+i\frac{e}{c}A_0\phi^*) +\pi^*(\pi-i\frac{e}{c}A_0\phi^) \\
%  &-\frac{\vect{\Pi}^2}{2\epsilon_0} + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
% &-\frac{\pi^*\pi}{2}+ \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
% +\phi^*(u(x)+m^2)\phi\\
  &:= \int d\vect{x}\bigg[\frac{\vect{\Pi}^2}{2\epsilon_0}+\frac{1}{2\mu_0}(\nabla\times\vect{A})^2+\pi^*\pi 
 +\phi^*(-\nabla^2 + u(x)+m^2)\phi\nonumber\\
 &\hspace{1cm}  +i\frac{e}{c}A_0(\pi \phi^*-\pi^*\phi) 
   +i\frac{e}{c}\vect{A}\cdot \big(\phi\nabla\phi^*-\phi^*\nabla\phi\big)+\frac{e^2}{c^2}|\vect{A}|^2\phi^*\phi
+A_0\frac{\nabla\cdot\vect{\Pi}}{\epsilon_0}
 \bigg]
\end{align}

Given the Hamiltonian, the partition function can be readily computed, given the Gaussian
nature of the integrals.  The long-and-short of this procedure should be that we will find 
$Z\sim\int D()e^{-S_E}.$
\begin{align}
  Z &= \tr[e^{-\beta \op{H}}]\\
  &= \int d^2\phi d\vect{A} dA_0 \langle A_0,\vect{A}| e^{-\beta \op{H}}|A_0,\vect{A}\rangle\\
  &= \int D\phi^*D\phi D\vect{A} DA_0 D\pi^*D\pi D\vect{\Pi}D\Pi_0\delta(\pi_0)\delta(\nabla\cdot\Pi)
  e^{-\Delta \beta H_n +\frac{i}{\hbar}(\vect{\Pi}\cdot\partial_\beta \vect{A}+\pi^*\partial_\beta\phi )}
\end{align}
\comment{should probably split $\phi = \phi_1+i\phi_2$ integrating over complex fields requires some
care with the book-keeping.  Then find $\pi_1,\pi_2$.  Can use $\langle \phi_1|\pi_1\rangle = e^{i\phi_1\pi_1/\hbar}$.
}

End result of careful integration over two independent real fields for matter, we can just skip to 
\begin{align}
  Z = \int D\phi^*D\phi D\vect{A}DA_0 e^{-S_E},
\end{align}
where
\begin{align}
  S_E =& \int_0^{\hbar\beta} d\tau\int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_\tau\vect{A})^2
  + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2\nonumber\\
  &+\bigg(\partial_\tau+i\frac{e}{c}A_0\bigg)\phi^*\bigg(\partial_\tau-i\frac{e}{c}A_0\bigg)\phi
  + \bigg(\nabla+i\frac{e}{c}\vect{A}\bigg)\phi^*\bigg(\nabla-i\frac{e}{c}\vect{A}\bigg)\phi
  +\phi^*(u(x)+m^2)\phi\bigg],
\end{align}
and $\tau=\hbar \beta$, and we also scaled $A_0\rightarrow \hbar^{-1} A_0$.  

Now expand the matter part out to quadratic order in the coupling.
\begin{align}
  S_E =& \int_0^{\hbar\beta} d\tau\int d^3\vect{x}\,\bigg[ \frac{\epsilon_0}{2}(\nabla A_0+\partial_\tau\vect{A})^2
  + \frac{1}{2\mu_0}(\nabla\times\vect{A})^2
  +\phi^*\big(-\partial_\tau^2-\nabla^2+u(x)+m^2\big)\phi\nonumber\\
  &+ i\frac{e}{c}A^\mu(\phi^*\partial_\mu\phi -\phi\partial_\mu\phi^*)
  +\frac{e^2}{c^2}A^\mu A_\mu\phi^*\phi-i\frac{e}{c}\partial_\mu A^\mu\phi^*\phi\bigg] 
\end{align}
where we are using the Euclidean inner product for 4-vectors.  

\begin{itemize}
  \item Expand exponential to second order in $e$.
    \begin{equation}
    e^{-\int d^4x A_\mu j^\mu} \approx (1 - \int d^4x A_\mu(x)j^\mu(x) +\frac{1}{2}\int d^4x A_\mu(x) A_\nu(y)
    j^\mu(x)j^\nu(y))
  \end{equation}
  \item Evaluate Gaussian integrals,
    \begin{equation}
      \int D\phi D\phi^* \phi^*(x)\phi(x) e^{-\int d^4x \phi^*(x)G^{-1}\phi(x)} = G(x)
    \end{equation}
  \item Simplify, Re-exponentiate.
    Some people use Kubo formula.
    By definition for linear response, with Ohm's law 
    \begin{equation}
      \vect{J} = \sigma \vect{E},
    \end{equation}
    so $\sigma = \epsilon-1$.  
    Kubo formula for conductivity in linear response is 
    $\sigma^{\mu\nu}(\omega) = \int dt \langle[ j^\mu(t),j^\nu(t')] e^{-i\omega t}.$
    Quite general relationship.  $\sigma$ is susceptibility, $[j,j]$ is Green function response.  
    
    Hopefully can do this calculation for general 


\end{itemize}



What are the gauge-invariance properties?  Gauge-invariance implies current conversation.  





%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "thesis_master"
%%% End: 
